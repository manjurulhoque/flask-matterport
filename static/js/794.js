(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[794],{91975:t=>{"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAJ1BMVEUAAAD///////////////////////////////////////////////+uPUo5AAAADHRSTlMA4ZNBI+fLwLSGYE5aqgIgAAAAlUlEQVQoz2MAAy91mYNFSxjgwEjmDBAcVIbxPWPOgMHRKRA+c88ZKDhhABbYdgYOssEKchACx0BKPM4ggRagwBxkgZNAHTHIAkcNGJjOoAAFBkdUARGGNagCpxh0UAUOMdSgChxnkEEVOMhwBg1gCGBowTAUw1oMh2E4HcNzGN5HDyCMIMQIZPRowIgozKjEjGyM5AAACSg5ooJJElsAAAAASUVORK5CYII="},40886:t=>{"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAPFBMVEUAAAD/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/////+fr/5er/0tv/ytX/iaH/dJL/cpA84uD/AAAAC3RSTlMA45NBI8vAtIZgTrS8MGcAAAC5SURBVDjLhVPtDoQgDBuICPKpvP+7Xs4t6LlL2j9GWtYCG91w0XqTkvE2OtJYrEkTxi4v2gWhpyS4n+1bUtgeRfY1/cG6z/3Ma8Ui/rP+6LWU2sd04RxBfs+WBe2UpXAZSP4jP3DIWb4m9ua1whI5w/XzC+xiHEWWtreg8XoUh5EVhnj469u1oF+EJ45QtaByCGKrogWFGSiAFjAkPCa8KHjV6LHgc6OGgS2Hmha2PR4cPHp4eOH4fwAGdiPh+RS0GAAAAABJRU5ErkJggg=="},71370:t=>{"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAIBAMAAABqq+CcAAAAD1BMVEUAAAD///////////////+PQt5oAAAABHRSTlMAy4AzqjrmZgAAABRJREFUCNdjAAMjERcXR2Uwc4AEAIn2CZHn9cAcAAAAAElFTkSuQmCC"},88296:t=>{"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAIBAMAAABqq+CcAAAAGFBMVEUAAAD/AVL/AVL/AVL/////AVL/r7//OWiicYg+AAAABHRSTlMAy4AzqjrmZgAAABlJREFUCNdjYGBgVgwtcwGC9FAhAyB3YAQAVg4X6a0jaXAAAAAASUVORK5CYII="},94085:(t,e,i)=>{"use strict";t.exports=i.p+"images/roboto-700-42_0.png"},98383:(t,e,i)=>{"use strict";i.d(e,{m:()=>a});var s=i(95891),n=i(18050);const o={0:s.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y,1:s.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z,2:s.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X,3:s.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z,4:s.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X,5:s.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y},a=t=>{if(t<0||t>5)throw new n.Z("mapFaceToCubemapFace() -> face must be in the range [0, 5]");return o[t]}},13462:(t,e,i)=>{"use strict";i.d(e,{c:()=>LineSegment});var s=i(84428),n=i(26517),o=i(77136);class LineEndpoint extends s.Mesh{constructor(t,e,i=o.V9.endpointSelected,s=o.V9.endpointDefault){super(t,e),this.selectedSize=i,this.defaultSize=s,this.currentSize=o.V9.endpointDefault,this.currentSize=this.defaultSize,this.scale.set(o.Ey,o.Ey,o.Ey)}dispose(){this.material.dispose(),this.geometry.dispose()}billboardScale(t,e,i){const s=(0,n.mY)(e,t,this.position,i,.5),a=Math.max(Math.min(1/s*this.currentSize,o.g4),o.Ey);this.scale.set(a,a,a)}updateSelected(t){this.currentSize=t?this.selectedSize:this.defaultSize}}var a=i(6436),r=i(82919),h=i(99295),c=i(28845),l=i(19945);class LineSegment{constructor(t,e,i,o,d){this.lineMaterial=i,this.options=o,this.endpointMaterial=d,this.startPosition=new s.Vector3,this.endPosition=new s.Vector3,this.endpoints=!1,this.isVisible=!0,this.meshToLinePartMap={},this.opacity=t=>(this.endpointMaterial&&this.endpointMaterial.setOpacity(t),this.lineMesh.material.setOpacity(t),this),this.updatePositions=(t,e)=>(this.startPosition.copy(t),this.endPosition.copy(e),this.options.beforeUpdatePositions&&(t=this.options.beforeUpdatePositions(t),e=this.options.beforeUpdatePositions(e)),this.lineMesh.geometry.setPositions([t.x,t.y,t.z,e.x,e.y,e.z]),this.endpoints&&(this.endMesh.position.copy(e),this.startMesh.position.copy(t),this.lastBillboardOptions&&this.updateBillboard(this.lastBillboardOptions)),this.lineMesh.material.dashed&&this.lineMesh.computeLineDistances(),this),this.updateBillboard=t=>{if(this.endpoints&&(t.rotation&&(this.endMesh.quaternion.copy(t.rotation),this.startMesh.quaternion.copy(t.rotation)),t.position&&t.projection&&!(0,n.s1)(t.projection))){const e=this.lineMesh.material.resolution.y;this.endMesh.billboardScale(t.position,t.projection,e),this.startMesh.billboardScale(t.position,t.projection,e)}return this.lastBillboardOptions=t,this},this.updateSelected=t=>(this.lineMesh.material.updateSelected(t),this.endpoints&&(this.endMesh.material.updateHovered(t),this.endMesh.updateSelected(t),this.startMesh.updateSelected(t)),this),this.setRenderLayer=t=>{this.children.forEach((e=>e.layers.mask=t.mask))},this.setRenderOrder=t=>{this.children.forEach((e=>e.renderOrder=t))},this.updateResolution=(t,e)=>(this.lineMesh.material.resolution.set(t,e),this),this.hide=()=>{this.options.onHide&&this.options.onHide(),this.isVisible=!1},this.show=()=>{this.options.onShow&&this.options.onShow(),this.isVisible=!0},this.toggle=t=>(t?this.show():this.hide(),this),this.dispose=()=>{this.options.onHide&&this.options.onHide(),this.lineMesh.geometry.dispose(),this.lineMesh.material.dispose(),this.endMesh&&this.endMesh.dispose(),this.startMesh&&this.startMesh.dispose(),this.meshToLinePartMap={}},this.overrideLineMaterial=t=>{this.lineMesh.material=t},this.restoreLineMaterial=()=>{this.lineMesh.material=this.lineMaterial},this.startPosition.copy(t),this.endPosition.copy(e),this.lineMesh=new a.x(new r.L,i),this.lineMesh.matrixAutoUpdate=!1,this.lineMesh.part=c.B.line,this.lineMesh.renderOrder=h.z.lines,this.meshToLinePartMap[c.B.line]=this.lineMesh,d&&(this.endpoints=!0,this.endMesh=new LineEndpoint((0,l.fc)(),d),this.endMesh.part=c.B.end,this.endMesh.renderOrder=h.z.endpoints,this.meshToLinePartMap[c.B.end]=this.endMesh,this.startMesh=new LineEndpoint((0,l.fc)(),d),this.startMesh.part=c.B.start,this.startMesh.renderOrder=h.z.endpoints,this.meshToLinePartMap[c.B.start]=this.startMesh),this.updatePositions(this.startPosition,this.endPosition),this.updateSelected(!1)}get currentOpacity(){return this.lineMesh.material.getOpacity()}getMesh(t){return this.meshToLinePartMap[t]}get children(){return Object.keys(this.meshToLinePartMap).map((t=>this.meshToLinePartMap[t]))}get visible(){return this.isVisible}}},28845:(t,e,i)=>{"use strict";var s;i.d(e,{B:()=>s}),function(t){t.line="line",t.start="start",t.end="end"}(s||(s={}))},4400:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>Lines,makeEndpointMaterial:()=>w,makeLineMaterial:()=>M});var s,n=i(57227),o=i(14877),a=i(84428),r=i(13462),h=i(89034),c=i(91975),l=i(40886),d=i(71370),u=i(88296);!function(t){t[t.LINE_DEFAULT=0]="LINE_DEFAULT",t[t.LINE_HOVER=1]="LINE_HOVER",t[t.END_DEFAULT=2]="END_DEFAULT",t[t.END_HOVER=3]="END_HOVER"}(s||(s={}));class LineTextures{constructor(){const t=(0,h.p)(c),e=(0,h.p)(l),i=(0,h.p)(d),n=(0,h.p)(u);this.textures={[s.LINE_DEFAULT]:i,[s.LINE_HOVER]:n,[s.END_DEFAULT]:t,[s.END_HOVER]:e},i.minFilter=a.LinearFilter,n.minFilter=a.LinearFilter,t.minFilter=a.LinearFilter,e.minFilter=a.LinearFilter}get(t){return this.textures[t]}dispose(){for(const t in this.textures){const e=Number(t);this.get(e).dispose()}}}var p=i(97137);class LineEndpointMaterial extends a.RawShaderMaterial{constructor(t,e,i){const s=a.UniformsUtils.clone(p.T.endpoint.uniforms);super({fragmentShader:p.T.endpoint.fragmentShader,vertexShader:p.T.endpoint.vertexShader,uniforms:s,name:"LineEndpointMaterial",transparent:!0,depthWrite:!1,depthTest:!0}),this.color=t,this.defaultTex=e,this.hoverTex=i,this.uniforms.bg.value=e,this.uniforms.color.value.copy(this.color)}clone(){return new LineEndpointMaterial(this.color,this.defaultTex,this.hoverTex).copy(this)}setOpacity(t){this.uniforms&&t!==this.uniforms.opacity.value&&(this.uniforms.opacity.value=t)}getOpacity(){return this.uniforms.opacity.value}updateHovered(t){const e=t?this.hoverTex:this.defaultTex;this.uniforms.bg.value!==e&&(this.uniforms.bg.value=e)}}var f=i(36173),m=i(15099),g=i(83804),A=i(82722),S=i(77136);let v=null;function x(){return v||(v=new LineTextures),v}class Lines extends n.Y{constructor(){super(...arguments),this.name="lines"}async init(t,e){const i=await e.getModuleBySymbol(o.y.WEBGL_RENDERER);this.scene=i.getScene(),this.canvas=await e.market.waitForData(A.W),this.cameraData=await e.market.waitForData(m.M_),this.bindings.push(this.canvas.onChanged(this.onCanvasChange.bind(this))),this.cameraPosition=new a.Vector3,this.segments=[]}onUpdate(){this.cameraPosition.copy(this.cameraData.pose.position)}dispose(t){super.dispose(t),this.segments.forEach((t=>t.dispose()))}makeLine(t,e,i,s,n=(()=>!1)){const o=n()?S.iV.OFFSET_TOWARDS_CAMERA:0,a=n()?t=>this.cameraPosition.clone().sub(t).setLength(o).add(t):t=>t,h=new r.c(t,e,i,{beforeUpdatePositions:a,onShow:()=>h.children.forEach((t=>this.scene.addChild(g.a.Root,t))),onHide:()=>h.children.forEach((t=>this.scene.removeChild(g.a.Root,t)))},s);return h.updateResolution(this.canvas.width,this.canvas.height),h.opacity(1),h.show(),h.updatePositions(t,e),this.segments.push(h),h}makeLineMaterial(t,e,i={},s,n){return M(t,e,i,s,n)}makeEndpointMaterial(t,e,i){return w(t,e,i)}onCanvasChange(t){for(const e of this.segments)e.updateResolution(t.width,t.height)}}function w(t,e,i){const n=i||x().get(s.END_HOVER),o=e||x().get(s.END_DEFAULT);return new LineEndpointMaterial(new a.Color(t),o,n)}function M(t,e,i={},n,o){const r=o||x().get(s.LINE_HOVER),h=n||x().get(s.LINE_DEFAULT),c=new a.Vector2(window.innerWidth,window.innerHeight);return e?new f.Y(Object.assign({color:new a.Color(t),resolution:c},i),r,h):new f.Y(Object.assign({color:new a.Color(t)},i))}},6436:(t,e,i)=>{"use strict";i.d(e,{x:()=>Line});var s=i(84428),n=i(28845);class Line extends s.Mesh{constructor(t,e){super(),this.type="Line",this.part=n.B.line,this.computeLineDistances=(()=>{const t=new s.Vector3,e=new s.Vector3;return()=>{const i=this.geometry,n=i.attributes.instanceStart,o=i.attributes.instanceEnd,a=new Float32Array(2*n.data.count);for(let i=0,s=0,r=n.data.count;i<r;i++,s+=2)t.fromBufferAttribute(n,i),e.fromBufferAttribute(o,i),a[s]=0===s?0:a[s-1],a[s+1]=a[s]+t.distanceTo(e);return this.instanceDistanceBuffer?(this.instanceDistanceBuffer.set(a,0),this.instanceDistanceBuffer.needsUpdate=!0):(this.instanceDistanceBuffer=new s.InstancedInterleavedBuffer(a,2,1),i.setAttribute("instanceDistanceStart",new s.InterleavedBufferAttribute(this.instanceDistanceBuffer,1,0,!1)),i.setAttribute("instanceDistanceEnd",new s.InterleavedBufferAttribute(this.instanceDistanceBuffer,1,1,!1))),this}})(),this.geometry=t,this.material=e}copy(t){throw Error("not implemented")}}},82919:(t,e,i)=>{"use strict";i.d(e,{L:()=>LineGeometry});var s=i(86464);class LineGeometry extends s.z{constructor(){super(),this.type="LineGeometry",this.isLineGeometry=!0}setPositions(t){const e=t.length-3,i=new Float32Array(2*e);for(let s=0;s<e;s+=3)i[2*s]=t[s],i[2*s+1]=t[s+1],i[2*s+2]=t[s+2],i[2*s+3]=t[s+3],i[2*s+4]=t[s+4],i[2*s+5]=t[s+5];return s.z.prototype.setPositions.call(this,i),this}setColors(t){const e=t.length-3,i=new Float32Array(2*e);for(let s=0;s<e;s+=3)i[2*s]=t[s],i[2*s+1]=t[s+1],i[2*s+2]=t[s+2],i[2*s+3]=t[s+3],i[2*s+4]=t[s+4],i[2*s+5]=t[s+5];return s.z.prototype.setColors.call(this,i),this}fromLine(t){throw new Error("LineGeometry.fromLine not converted to TS yet")}copy(t){return this}}},36173:(t,e,i)=>{"use strict";i.d(e,{Y:()=>LineMaterial});var s=i(84428),n=i(97137),o=i(77136);class LineMaterial extends s.RawShaderMaterial{constructor(t,e,i,a=o.V9.lineSelected){super(),this.parameters=t,this.hoverTexture=e,this.defaultTexture=i,this.selectedWidth=a,this.type="LineMaterial",this.isLineMaterial=!0,this.defaultWidth=o.V9.lineDefault,this.setValues({uniforms:s.UniformsUtils.clone(n.T.line.uniforms),vertexShader:n.T.line.vertexShader,fragmentShader:n.T.line.fragmentShader,transparent:!0,depthWrite:!1,depthTest:!0,opacity:1}),this.setValues(t),i&&(this.mask=i),this.defaultWidth=t&&t.linewidth?t.linewidth:o.V9.lineDefault}updateSelected(t){const e=t?this.hoverTexture:this.defaultTexture;e&&this.mask!==e&&(this.mask=e,t?this.setLinewidth(this.selectedWidth):this.setLinewidth(this.defaultWidth))}setLinewidth(t){this.uniforms.linewidth||(this.uniforms=s.UniformsUtils.clone(n.T.line.uniforms)),this.getLinewidth()!==t&&(this.uniforms.linewidth.value=t)}getLinewidth(){return this.uniforms.linewidth.value}get color(){return this.uniforms.diffuse.value}set color(t){this.uniforms.diffuse.value=t}getOpacity(){return this.uniforms.opacity.value}setOpacity(t){this.uniforms||(this.uniforms=s.UniformsUtils.clone(n.T.line.uniforms)),this.getOpacity()!==t&&(this.uniforms.opacity.value=t)}get dashScale(){return this.uniforms.dashScale.value}set dashScale(t){this.uniforms.dashScale.value=t}set dashed(t){t?this.defines.USE_DASH="":delete this.defines.USE_DASH,this.needsUpdate=!0}get dashed(){return"USE_DASH"in this.defines}get dashSize(){return this.uniforms.dashSize.value}set dashSize(t){this.uniforms.dashSize.value=t}get gapSize(){return this.uniforms.gapSize.value}set gapSize(t){this.uniforms.gapSize.value=t}get resolution(){return this.uniforms.resolution.value}set resolution(t){this.uniforms.resolution.value=t}set mask(t){this.uniforms.mask.value!==t&&(t?this.defines.USE_MASK="":delete this.defines.USE_MASK,this.uniforms.mask.value=t,this.needsUpdate=!0)}get mask(){return this.uniforms.mask.value}copy(t){return s.RawShaderMaterial.prototype.copy.call(this,t),this.parameters=t.parameters,this.color.copy(t.color),this.defaultWidth=t.defaultWidth,this.setLinewidth(t.getLinewidth()),this.resolution.copy(t.resolution),this.defaultTexture=t.defaultTexture,this.hoverTexture=t.hoverTexture,this.mask=t.mask,this.setOpacity(t.getOpacity()),this.dashed=t.dashed,this.dashScale=t.dashScale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}},86464:(t,e,i)=>{"use strict";i.d(e,{z:()=>LineSegmentsGeometry});var s=i(84428);class LineSegmentsGeometry extends s.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new s.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new s.Float32BufferAttribute([0,1,.5,1,0,.5,.5,.5,0,0,.5,0,0,1,.5,1],2))}applyMatrix(t){const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==e&&(e.applyMatrix4(t),i.applyMatrix4(t),this.positionBuffer.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(t){let e;return t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t)),e&&(this.positionBuffer?(this.positionBuffer.set(e,0),this.positionBuffer.needsUpdate=!0):(this.positionBuffer=new s.InstancedInterleavedBuffer(e,6,1),this.setAttribute("instanceStart",new s.InterleavedBufferAttribute(this.positionBuffer,3,0,!1)),this.setAttribute("instanceEnd",new s.InterleavedBufferAttribute(this.positionBuffer,3,3,!1))),this.computeBoundingBox(),this.computeBoundingSphere()),this}setColors(t){let e;return t instanceof Float32Array?e=t:Array.isArray(t)&&(e=new Float32Array(t)),e&&(this.colorBuffer?(this.colorBuffer.set(e,0),this.colorBuffer.needsUpdate=!0):(this.colorBuffer=new s.InstancedInterleavedBuffer(e,6,1),this.setAttribute("instanceColorStart",new s.InterleavedBufferAttribute(this.colorBuffer,3,0,!1)),this.setAttribute("instanceColorEnd",new s.InterleavedBufferAttribute(this.colorBuffer,3,3,!1)))),this}fromWireframeGeometry(t){return this.setPositions(t.attributes.position.array),this}fromEdgesGeometry(t){return this.setPositions(t.attributes.position.array),this}fromMesh(t){return this.fromWireframeGeometry(new s.WireframeGeometry(t.geometry)),this}fromLineSegements(t){const e=t.geometry;return e instanceof s.BufferGeometry&&this.setPositions(e.position.array),this}computeBoundingBox(){this.boundingBox||(this.boundingBox=new s.Box3),this.box||(this.box=new s.Box3);const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;void 0!==t&&void 0!==e&&(this.boundingBox.setFromBufferAttribute(t),this.box.setFromBufferAttribute(e),this.boundingBox.union(this.box))}computeBoundingSphere(){this.tempVector||(this.tempVector=new s.Vector3),this.boundingSphere||(this.boundingSphere=new s.Sphere),this.boundingBox||this.computeBoundingBox();const t=this.attributes.instanceStart,e=this.attributes.instanceEnd;if(void 0!==t&&void 0!==e){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let s=0;for(let n=0,o=t.count;n<o;n++)this.tempVector.fromBufferAttribute(t,n),s=Math.max(s,i.distanceToSquared(this.tempVector)),this.tempVector.fromBufferAttribute(e,n),s=Math.max(s,i.distanceToSquared(this.tempVector));this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error("computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}},97137:(t,e,i)=>{"use strict";i.d(e,{T:()=>n});var s=i(84428);const n={endpoint:{uniforms:{opacity:{type:"f",value:1},color:{type:"c",value:new s.Color},bg:{type:"t",value:null}},vertexShader:i(64656),fragmentShader:i(33404)},line:{uniforms:s.UniformsUtils.merge([s.UniformsLib.common,s.UniformsLib.fog,{linewidth:{value:4},resolution:{value:new s.Vector2(0,0)},dashScale:{value:1},dashSize:{value:.025},gapSize:{value:.05},mask:{value:null}}]),vertexShader:i(86676),fragmentShader:i(42154)}}},77136:(t,e,i)=>{"use strict";i.d(e,{iV:()=>s,V9:()=>n,Ey:()=>o,g4:()=>a});const s={FADE_DURATION:300,LABEL_HIDDEN_OPACITY:.15,DEPTH_WRITE_THRESHOD:.15,ALIGN_LABELS:!1,LABEL_SIZING:.14,LABEL_NDC_SCALEFACTOR:.5,LABEL_ASPECT_SCALEFACTOR:.035,OFFSET_TOWARDS_CAMERA:.25,HIDE_LABELS:!1},n={dottedLineDefault:2,lineDefault:6,lineSelected:6,endpointDefault:2.5,endpointSelected:3.75},o=.01,a=5},91825:(t,e,i)=>{"use strict";i.d(e,{i:()=>SkySphereMesh});var s=i(84428);class SkySphereMesh extends s.Mesh{}},99931:(t,e,i)=>{"use strict";i.d(e,{Dv:()=>h,TE:()=>c,o7:()=>l,l0:()=>d,Bv:()=>u});var s=i(84428);const n=-1,o=10,a=5,r=-5,h=(t,e=n)=>i=>t.distanceToSquared(i.position)*e,c=(t,e=n)=>i=>t.distanceTo(i.position)*e,l=(t,e,i=o)=>{const n=new s.Vector3;return s=>n.copy(s.position).sub(t).normalize().dot(e)*i},d=(t,e=n)=>i=>t.distanceToSquared(i.floorPosition)*e,u=(t,e=a,i=r)=>s=>t===s.floorId?e:i},23714:(t,e,i)=>{"use strict";var s;i.d(e,{Z:()=>n}),function(t){t[t.Center=0]="Center",t[t.UpperLeft=1]="UpperLeft",t[t.UpperRight=2]="UpperRight",t[t.LowerRight=3]="LowerRight",t[t.LowerLeft=4]="LowerLeft"}(s||(s={}));const n=s},33357:(t,e,i)=>{"use strict";i.d(e,{S:()=>c,Z:()=>PanoQualityManager});var s=i(36407),n=i(40386),o=i(53675),a=i(63901),r=i(31013);const h=new(i(5477).Z)("panoqualitymanager");var c;!function(t){t[t.Untested=0]="Untested",t[t.Testing=1]="Testing",t[t.Success=2]="Success",t[t.Fail=3]="Fail"}(c||(c={}));class PanoQualityManager{constructor(t,e,i,s){this.urls=t,this.maxCubemapSize=e,this.maxNavPanoSize=i,this.maxZoomPanoSize=s,this.overrideWindow=!1,this.devicePixelRatio=window.devicePixelRatio||1,this.navPanoSize=-1,this.zoomPanoSize=-1,this.windowHeight=window.innerHeight*this.devicePixelRatio,this.highQualityThreshold=n.Xd.windowHeightHighQualityThresholdOverride||n.Xd.windowHeightHighQualityThreshold,this.persistentStorage=new o.a,this.downloadTestResults={},this.updateMaximums()}setWindowSize(t,e){this.windowHeight=e*this.devicePixelRatio,this.updateMaximums()}overrideWindowMaximums(t){this.overrideWindow=t,this.updateMaximums()}updateNavPanoSize(t){this.maxNavPanoSize=t,this.updateMaximums()}getTestResults(t,e){const i=this.downloadTestResults[t];if(i){const t=i[e];if(t)return t}return c.Untested}ultraHighQualityModeEnabled(t){const e=s.Qf[this.getZoomPanoSize()],i=this.downloadTestResults[t];return!(!i||!i[e])&&i[e]===c.Success}updateMaximums(){this.windowHeight<this.highQualityThreshold&&!this.overrideWindow?(this.navPanoSize=Math.min(PanoQualityManager.getPanoSize(s.SL.STANDARD),this.maxNavPanoSize),this.zoomPanoSize=Math.min(PanoQualityManager.getPanoSize(s.SL.HIGH),this.maxZoomPanoSize)):(this.navPanoSize=this.maxNavPanoSize,this.zoomPanoSize=this.maxZoomPanoSize),this.zoomPanoSize<this.navPanoSize&&(this.navPanoSize=this.zoomPanoSize),this.zoomPanoSize=Math.min(this.maxCubemapSize,this.zoomPanoSize),this.navPanoSize=Math.min(this.maxCubemapSize,this.navPanoSize)}static getPanoSize(t){if(t in s.eE)return s.eE[t];throw new Error(`Not a panoSizeClass: ${t}`)}static getPanoSizeClass(t){if(t in s.Qf)return s.Qf[t];throw new Error(`Not a valid pano resolution: ${t}`)}getMaxPossiblePanoSize(){return PanoQualityManager.getPanoSize(s.SL.ULTRAHIGH)}getNavPanoSize(){return this.navPanoSize}getZoomPanoSize(){return this.zoomPanoSize}availableResolution(t,e){const i=new r.Q;if(!e)return i.reject(0);if(t.resolutions)return t.resolutions.includes(e)?i.resolve(e):this.availableResolution(t,this.getLowerResolution(e));switch(this.getTestResults(t.id,e)){case c.Success:i.resolve(e);break;case c.Fail:return this.availableResolution(t,this.getLowerResolution(e));case c.Untested:this.testDownload(t,e,a.I_).then((s=>{s?i.resolve(e):this.availableResolution(t,this.getLowerResolution(e)).then((t=>i.resolve(t)))}));break;case c.Testing:h.warn("resolution is already testing, do we need to handle this?")}return i}getLowerResolution(t){switch(t){case s.SL.ULTRAHIGH:return s.SL.HIGH;case s.SL.HIGH:return s.SL.STANDARD;case s.SL.STANDARD:return s.SL.BASE}return null}testDownload(t,e,i){if(!this.urls)throw new Error("Can't call testDownload without signed urls");const s=PanoQualityManager.getPanoSize(e),n=new r.Q,o=t.id;this.downloadTestResults[o]||(this.downloadTestResults[o]={});const a=this.downloadTestResults[o]&&this.downloadTestResults[o][e];if(a)a===c.Success?n.resolve(!0):a===c.Fail&&n.resolve(!1);else{this.downloadTestResults[o][e]=c.Testing;const a=t=>{this.downloadTestResults[o][e]=c.Success,n.resolve(!0)},r=()=>{this.downloadTestResults[o][e]=c.Fail,n.resolve(!1)};this.getTileUrl(t,s,i,0).then((t=>{this.urls.getImage(t).then(a,r)}))}return n}getTileUrl(t,e,i,s){const n=this.persistentStorage.get("getTileUrl:locationInfo",(()=>({face:-1,faceTileIndex:-1,tileX:-1,tileY:-1})));a.Tp(e,s,n);const o=Math.floor(e/i),r=o*o,h=Math.floor(s/r),c=PanoQualityManager.getPanoSizeClass(e);return t.getTileUrl(c,h,n.tileX,n.tileY)}}},63901:(t,e,i)=>{"use strict";i.d(e,{I_:()=>h,Hq:()=>c,P6:()=>l,R5:()=>d,Tp:()=>u,Tu:()=>p,ym:()=>f,oU:()=>m,eO:()=>A});var s=i(95891),n=i(84428),o=i(23714),a=i(98383),r=i(994);const h=512,c=6,l=(t,e,i,n,a,r,h,c)=>{const l=t/e,d=2*(e/t),u=d/2;let p=2*(n/l)-1+u,f=2*((a=l-1-a)/l)-1+u;switch(r=r||o.Z.Center){case o.Z.UpperLeft:p-=u,f+=u,p+=h*d;break;case o.Z.UpperRight:p+=u,f+=u,f-=h*d;break;case o.Z.LowerRight:p+=u,f-=u,p-=h*d;break;case o.Z.LowerLeft:p-=u,f-=u,f+=h*d;break;case o.Z.Center:}switch(i){case s.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X:c.set(-1,f,-p);break;case s.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:c.set(1,f,p);break;case s.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:c.set(-p,1,-f);break;case s.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:c.set(-p,-1,f);break;case s.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:c.set(-p,f,1);break;case s.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:c.set(p,f,-1)}c.normalize()},d=(t,e)=>{let i=h;t<h&&(i=t);const s=Math.floor(t/i),n=s*s;return Math.floor(e/n)},u=(t,e,i)=>{let s=h;t<h&&(s=t);const n=d(t,e),o=Math.floor(t/s),a=e-n*(o*o);i.tileX=a%o,i.tileY=Math.floor(a/o),i.face=n,i.faceTileIndex=a},p=function(t){if(t<=h)return c;const e=Math.floor(t/h);return e*e*c},f=function(){const t=new n.Matrix4,e=new n.Quaternion;return(i,s)=>{e.copy(i),e.invert(),t.makeRotationFromQuaternion(e),s.applyMatrix4(t),s.normalize()}}(),m=function(){const t=new n.Vector3,e=new n.Vector3(0,0,-1),i=new n.Quaternion,s=function(t,e){t.push({face:e.face,faceTileIndex:e.faceTileIndex,tileX:e.tileX,tileY:e.tileY})},o=function(){const t={face:-1,faceTileIndex:-1,tileX:-1,tileY:-1};return(e,i,n)=>{const o=p(e);let a=0;for(let r=0;r<o;r++)u(e,r,t),i&&!i(t)||(a++,n&&s(n,t));return a}}();return(s,a,r,c,l=!1,d,u)=>{c.length=l?0:c.length;const p=a<h?a:h;if(!d&&!u)return o(a,null,c);const m=!!u;d=d||0,u=u||d,u=Math.max(0,Math.min(u,360)),d=Math.max(0,Math.min(d,360)),t.copy(r);const S=s.rotation||new n.Quaternion;if(f(S,t),m){i.setFromUnitVectors(t,e);return o(a,(function(t){return g(a,p,t.face,t.tileX,t.tileY,i,d||0,u||0)}),c)}return o(a,(function(e){return A(a,p,e.face,e.tileX,e.tileY,t,d||0)}),c)}}(),g=function(){const t=new n.Vector3;return(e,i,s,n,h,c,d,u)=>{const p=Math.tan(.5*u*r.Ue),f=-p,m=Math.tan(.5*d*r.Ue),g=-m,A=(0,a.m)(s);let S=0,v=0,x=0,w=0,M=0;for(let s=o.Z.Center;s<=o.Z.LowerLeft;s++){if(l(e,i,A,n,h,s,0,t),t.applyQuaternion(c),t.z>=-1e-5)continue;const o=-1/t.z,a=t.x*o,r=t.y*o;r>p?S++:r<f&&v++,a>m?x++:a<g&&w++,M++}return v!==M&&S!==M&&x!==M&&w!==M}}(),A=function(){const t=new n.Vector3,e=new n.Vector3(0,1,0),i=new n.Vector3(1,0,0);return(s,n,r,h,c,d,u)=>{const p=(0,a.m)(r);if(i.copy(d).cross(e),l(s,n,p,h,c,o.Z.Center,0,t),S(t,d,u))return!0;const f=u/360,m=Math.floor(1/f);let g=0;for(let e=0;e<m;e++){for(let e=o.Z.UpperLeft;e<=o.Z.LowerLeft;e++)if(l(s,n,p,h,c,e,g,t),S(t,d,u))return!0;g+=f}return!1}}(),S=function(){const t=new n.Vector3,e=new n.Vector3;return(i,s,n,o)=>{if(e.copy(i),o){t.copy(o),t.normalize();const s=t.dot(i);t.x*=s,t.y*=s,t.z*=s,e.sub(t)}const a=n/2*r.Ue,h=Math.cos(a);return e.dot(s)>=h}}()},22808:(t,e,i)=>{"use strict";var s;i.d(e,{v:()=>s}),function(t){t[t.CurrentView=0]="CurrentView",t[t.FullPanorama=1]="FullPanorama"}(s||(s={}))},60424:(t,e,i)=>{"use strict";i.d(e,{Q:()=>FontManager});var s=i(87100),n=i(5477),o=i(46352),a=i(89034),r=i(94085),h=i(98254);class BitmapFontAtlas extends h.T{constructor(t){super(),this.packer=t,this.fontData=o.H,this.textures=[]}update(t,e){this.fontData=e,this.textures.forEach((t=>t.dispose())),this.textures.length=0,this.textures.push(...t),this.commit()}addCharsIfNeeded(t){this.packer.addChars(t)}}const c=new n.Z("FontManager");class BitmapFontPackerStatic{constructor(){this.name="roboto-700-42-static",this._atlas=new BitmapFontAtlas(this),this._codePointToTexCoord={},this.mWidth=0}async loadFont(){const[t,e]=await Promise.all([(0,a.p)(r),i.e(386).then(i.t.bind(i,60386,19))]),s=e.default;return this.estimateWidth(s),this._atlas.update([t],s),Promise.resolve({fontPath:this.name,font:this.name,packer:this})}addChars(t){c.debug(this.name,"does not support dynamic char adding")}measureText(t){if(this.mWidth)return t.length*this.mWidth}atlas(){return this._atlas}codepointMap(){return this._codePointToTexCoord}estimateWidth(t){const e=t.chars.find((t=>t.id==="m".charCodeAt(0)));e&&(this.mWidth=e.width)}}const l=(()=>{let t=null;return function(){return t||(t=Promise.all([i.e(976),i.e(422),i.e(143)]).then(i.bind(i,44422)).then((t=>t.load))),t}})();var d=i(35995),u=i(84428);const p=function(){const t=document.createElement("a");return document.body.appendChild(t),t.style.display="none",(e,i)=>{const s=e.toDataURL();t.href=s,t.download=i,t.click()}}(),f=(t,e)=>{const i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),i.setAttribute("download",e),i.click()};var m=i(37796);const g=new n.Z("font-packer"),A={outlineOffset:Number((0,s.eY)("outlineOffset",.2)),save:"1"===(0,s.eY)("exportfont","0"),saveDefaultFont:"1"===(0,s.eY)("exportdefault","0"),verboseChars:!0,verboseFont:!0,perf:{log:!1,marks:{rebuild:"rebuild",kern:"kerning",metrics:"metrics",pack:"pack",texture:"texture",bmfont:"load-bmfont"}}};class BitmapFontPacker{constructor(t,e){if(this.needsRebuild=!1,this._atlas=new BitmapFontAtlas(this),this._codepointToTexCoord={},this._loading=!1,this._loaded=!1,this._addedChars=[],this.charSet=new Set,this.kerningsMap={},this.measureMap={},this.metricsMap={},this.scale=1,this.updateCanvas=(t,e)=>{try{this.canvas||(this.canvas=document.createElement("canvas")),this.canvas.height=t,this.canvas.width=e;const i=this.canvas&&this.canvas.getContext("2d");if(!i)throw Error("Unable to create canvas context for font-packer");this.ctx=i,this.ctx.fillStyle="white",this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left",this.ctx.font=this.contextFontFace}catch(t){g.error("Failed to create canvas rendering context",t)}},this.throttledRebuild=(0,m.P)((()=>{setTimeout((()=>this.rebuild()),0)}),1500),this.options=t,e&&(this.font=e),this.updateCanvas(this.options.height,this.options.width),this.packer=new d.cC(this.options.width,this.options.height,2*this.options.texturePadding),this.options.defaultCharset){(function(t=!1){const e=new Set(Array.from("m0123456789_-+'\"` \t")),i=[];t&&i.push([32,127]);for(const t of i)for(let i=t[0];i<t[1];i++)e.add(String.fromCharCode(i));return e})(this.options.defaultCharset===o.T.ASCII||A.saveDefaultFont).forEach((t=>this.charSet.add(t)))}var i;this.options.initialChars&&this.options.initialChars.forEach((t=>this.charSet.add(t))),this.options.squareSize&&(i=this.options.squareSize,Math.log(i)/Math.log(2)%1!=0)&&g.error("font config squareSize must be a power of two")}get loaded(){return!this._loading&&this._loaded}async loadFont(){let t;A.perf.log&&performance.mark(A.perf.marks.bmfont);const e=`${this.options.fontFamily} for BitmapFontPacker`;if(!this.font){this._loading=!0,t=new FontFace(e,`url("${this.options.fontPath}") format("woff")`,{style:`${this.options.fontStyle}`,weight:`${this.options.fontWeight}`}),t.load();const i=t.loaded;document.fonts.add(t);const s=(await l())(this.options.fontPath),[n]=await Promise.all([s,i]);this.font=n}return A.perf.log&&performance.measure(A.perf.marks.bmfont,A.perf.marks.bmfont),this.scale=this.options.fontSize/this.font.unitsPerEm,this.contextFontFace=`${this.options.fontWeight} ${this.options.fontSize}px "${e}"`,this.ctx.font=this.contextFontFace,A.verboseFont&&g.debug({contextFontFace:this.contextFontFace,bmfont:this.font,charset:this.charSet}),this._loading=!1,this.fontFilename=`${this.options.fontFamily.toLowerCase()}-${this.options.fontWeight}-${this.options.fontSize}`+(this.options.outline?"-outline-"+this.options.outlineWidth:""),this.needsRebuild=!0,this.throttledRebuild(),{fontPath:this.options.fontPath,font:this.font,packer:this}}addChars(t){const e=this.charSet.size;return Array.from(t).forEach((t=>{this.charSet.has(t)||this._addedChars.push(t),this.charSet.add(t)})),e!==this.charSet.size&&(this.needsRebuild=!0,this.throttledRebuild()),this.needsRebuild}atlas(){return this._atlas}codepointMap(){return this._codepointToTexCoord}rebuild(){if(!this.font)return;if(this.loaded&&this._addedChars.length<1)return void(this.needsRebuild=!1);A.verboseChars&&(g.debug(`Added ${this._addedChars.length} glyphs: \n${this._addedChars}`),this._addedChars.length=0),performance.mark(A.perf.marks.rebuild),A.perf.log&&performance.mark(A.perf.marks.metrics);const t=this.getAllGlyphMetrics();A.perf.log&&performance.measure(A.perf.marks.metrics,A.perf.marks.metrics),A.perf.log&&performance.mark(A.perf.marks.pack);const e=this.pack(t);A.perf.log&&performance.measure(A.perf.marks.pack,A.perf.marks.pack),A.perf.log&&performance.mark(A.perf.marks.texture);const{chars:i,textures:s,codePointToTexCoord:n}=this.assembleTexture(e);A.perf.log&&performance.measure(A.perf.marks.texture,A.perf.marks.texture),A.perf.log&&performance.mark(A.perf.marks.kern);const o=this.getKerningPairs();A.perf.log&&performance.measure(A.perf.marks.kern,A.perf.marks.kern);const a=this.assembleFont(i,o,s);performance.measure(A.perf.marks.rebuild,A.perf.marks.rebuild),this._codepointToTexCoord=n,this._loaded=!0,this._atlas.update(s,a);const r=`Rebuilt atlas for ${this.charSet.size} chars with ${a.kernings.length} kerning pairs`;A.perf.log?(g.debug(r,performance.getEntriesByName(A.perf.marks.rebuild,"measure")[0],performance.getEntriesByType("measure").map((t=>({name:t.name,duration:t.duration}))),this.options),Object.values(A.perf.marks).forEach((t=>{performance.clearMarks(t),performance.clearMeasures(t)}))):(g.debug(r,performance.getEntriesByName(A.perf.marks.rebuild,"measure")[0]),performance.clearMarks(A.perf.marks.rebuild),performance.clearMeasures(A.perf.marks.rebuild))}pack(t){return this.packer.bins.length=0,this.packer.addArray(t),this.packer.bins.reverse()}assembleTexture(t){const e=[],i={},s=this.options.squareSize,n=t.map(((t,n)=>{const o=t.rects.length,{squareSize:a}=this.options,r=Math.ceil(Math.sqrt(o)),h=r*a,c=h,l=1/r;return s&&(h===this.canvas.width&&c===this.canvas.height||this.updateCanvas(c,h)),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.options.transparent&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),t.rects.forEach(((t,o)=>{const d=t.data.charData;let u=t.x-d.xoffset,p=t.y+d.height+d.ymin-this.options.texturePadding;if(s){const t=o%r,e=Math.floor(o/r),s=t*a,f=e*a;u=s+a/2,p=f+a-(a-this.options.fontSize)/2,57344===d.id&&(p+=5),i[d.id]={x:s,y:f,u:s/h,v:1-(f+a)/c,page:n,uvScale:l},this.ctx.textAlign="center"}this.options.outline&&this.options.outlineWidth>0?function(t,e,i,s,n){const o=t.strokeStyle,a=t.fillStyle,r=t.lineJoin,h=t.miterLimit;t.lineJoin="miter",t.miterLimit=2,t.beginPath(),t.strokeStyle="black",t.lineWidth=n,t.strokeText(e,i,s),t.beginPath(),t.fillStyle="white",t.fillText(e,i,s),t.strokeStyle=o,t.fillStyle=a,t.lineJoin=r,t.miterLimit=h}(this.ctx,t.data.charData.char,u,p,this.options.outlineWidth):this.ctx.fillText(t.data.charData.char,u,p),d.x=t.x,d.y=t.y,d.page=n,e.push(t.data.charData)})),A.save&&p(this.ctx.canvas,`${this.fontFilename}_${n}.png`),this.makeCanvasTexture(n,!1)}));return{chars:e,textures:n,codePointToTexCoord:i}}getKerningPairs(){const t=[],e=[...this.charSet.values()].map((t=>this.font.charToGlyphIndex(t))).filter((t=>t>0));for(const i of e)for(const s of e){const e=`${i},${s}`;let n=this.kerningsMap[e];if(!n){n={first:i,second:s,amount:this.font.getKerningValue(i,s)*this.scale},this.kerningsMap[e]=n}n&&0!==n.amount&&t.push(n)}return t}assembleFont(t,e,i){const s=this.font.tables.os2,n=this.font.tables.name.fullName,o=n[Object.getOwnPropertyNames(n)[0]],a={pages:i.map(((t,e)=>`${this.fontFilename}_${e}.png`)),chars:t,info:{face:o,size:this.options.fontSize,bold:0,italic:0,charset:[...this.charSet.values()],unicode:1,stretchH:100,smooth:1,aa:1,padding:[0,0,0,0],spacing:[this.options.texturePadding,this.options.texturePadding],os2version:s.version},common:{lineHeight:(s.sTypoAscender-s.sTypoDescender+s.sTypoLineGap)*this.scale,base:this.font.ascender*this.scale,scaleW:this.options.width,scaleH:this.options.height,pages:this.packer.bins.length,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0},kernings:e};return A.verboseFont&&g.debug({bmFontOutput:a,kerningPairCount:e.length}),A.save&&(f(JSON.stringify(a),`${this.fontFilename}.json`),f(JSON.stringify(this.options,void 0,2),`${this.fontFilename}-pack-options.json`)),a}getMetrics(t){const e=2*this.options.texturePadding,i=this.scale;let s,n,o,a,r,h;const c=this.font.charToGlyph(t),l=0!==c.index;if(l){let e=this.measureMap[t];e||(e=c.getMetrics(),this.measureMap[t]=e),s=(e.xMax-e.xMin)*i,n=(e.yMax-e.yMin)*i,o=e.xMin*i,a=e.yMin*i,r=e.yMax*i,h=c.advanceWidth*i}else{const e=this.measureChar(t);s=e.width,n=e.height,o=e.xMin,a=e.yMin,r=e.yMax,h=s}return{char:t,width:s+e,height:n+e,xmin:o,ymin:a,ymax:r,xadvance:h+(this.options.outline?this.options.outlineWidth*A.outlineOffset:0),supported:l}}measureText(t){if(!this.loaded)return;let e=0;for(const i of Array.from(t)){const{width:t}=this.measureChar(i);e+=t}return e}measureChar(t){let e=this.metricsMap[t];e||(e=this.ctx.measureText(t),this.metricsMap[t]=e);const i=e.actualBoundingBoxLeft+e.actualBoundingBoxRight;return{width:e.width||i,height:e.actualBoundingBoxAscent+e.actualBoundingBoxDescent,xMin:e.actualBoundingBoxLeft,xMax:e.actualBoundingBoxRight,yMin:-e.actualBoundingBoxDescent,yMax:e.actualBoundingBoxAscent}}getAllGlyphMetrics(){const t=[],e=this.font.ascender*this.scale,i=this.options.texturePadding;for(const s of this.charSet.values()){const n=this.getMetrics(s),o={data:{charData:{char:s,id:s.charCodeAt(0),width:n.width,height:n.height,xoffset:n.xmin-i,yoffset:e-n.ymax-i,xadvance:n.xadvance,chnl:15,ymin:n.ymin}},width:n.width,height:n.height};t.push(o)}return t}makeCanvasTexture(t,e){if(e){const t=new Uint8Array(this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data),e=new u.DataTexture(t,this.canvas.width,this.canvas.height,u.RGBAFormat);return e.needsUpdate=!0,e.flipY=!0,e}const i=new u.Texture(this.ctx.canvas);return i.name=`${this.ctx.font}_${t}`,i.format=u.RGBAFormat,i.needsUpdate=!0,i}}const S=new n.Z("FontManager"),v={fontPath:"fonts/roboto-700.woff",fontWeight:700,fontFamily:"Roboto",fontStyle:"normal",fontSize:60,width:2048,height:2048,transparent:!0,defaultCharset:o.T.ASCII,outline:!1,outlineWidth:4,texturePadding:6},x="1"===(0,s.eY)("staticfont","0");class FontManager{constructor(){this.defaultFontOptions=v,this.packerMap=new Map,this.optionsMap=new Map,this.parsedFontMap=new Map}static get instance(){return FontManager._instance||(FontManager._instance=new FontManager),FontManager._instance}getFontId(t=this.defaultFontOptions){const e=Object.assign(Object.assign({},this.defaultFontOptions),t),i=JSON.stringify(e);return this.optionsMap.set(i,e),i}getPacker(t){let e=this.packerMap.get(t);if(!e&&x&&(e=new BitmapFontPackerStatic,e.loadFont(),this.packerMap.set(t,e)),!e){const i=this.optionsMap.get(t)||JSON.parse(t),s=this.parsedFontMap.get(i.fontPath);e=new BitmapFontPacker(i,s),this.packerMap.set(t,e),e.loadFont().then((e=>{S.debug("font loaded",t,e.fontPath),this.parsedFontMap.set(e.fontPath,e.font)}))}return e}getFont(t){return this.getPacker(t).atlas()}getFontAndCodepoints(t){const e=this.getPacker(t);return{font:e.atlas(),codepointMap:e.codepointMap()}}measureText(t,e){const i=this.packerMap.get(t);if(i)return i.measureText(e)}}},46352:(t,e,i)=>{"use strict";var s;i.d(e,{T:()=>s,H:()=>n}),function(t){t[t.NONE=0]="NONE",t[t.NUMERIC=1]="NUMERIC",t[t.ASCII=2]="ASCII"}(s||(s={}));const n={pages:[],chars:[],info:{face:"Loading",size:0,bold:0,italic:0,charset:[],unicode:1,stretchH:100,smooth:1,aa:1,padding:[0,0,0,0],spacing:[0,0],os2version:1},common:{lineHeight:0,base:0,scaleW:1,scaleH:1,pages:0,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0},kernings:[]}},53675:(t,e,i)=>{"use strict";i.d(e,{a:()=>PersistentStorage});class VariableContainer{constructor(t){this._value=t}value(){return this._value}set(t){this._value=t}}class PersistentStorage{constructor(){this.storage={}}get(t,e){let i=this.storage[t];return i||(i=e(),this.storage[t]=i),i}getNumber(t){return this.get(t,(()=>new VariableContainer(0)))}getString(t){return this.get(t,(()=>new VariableContainer("")))}getArray(t){return this.get(t,(()=>[]))}getNumberMap(t){return this.get(t,(()=>({})))}getStringMap(t){return this.get(t,(()=>({})))}}},33404:t=>{t.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform float opacity;uniform vec3 color;uniform sampler2D bg;varying vec2 vUv;void main(){vec4 bgColor=texture2D(bg,vUv);gl_FragColor=vec4(bgColor.rgb,bgColor.a*opacity);}"},42154:t=>{t.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform vec3 diffuse;uniform float opacity;uniform sampler2D mask;\n#ifdef USE_DASH\nuniform float dashSize;uniform float gapSize;\n#endif\nvarying float vLineDistance;\n#include <common>\nvarying vec2 vUv;void main(){\n#ifdef USE_DASH\nif(vUv.y<-1.||vUv.y>1.)discard;if(mod(vLineDistance,dashSize+gapSize)>dashSize)discard;\n#endif\n#ifdef USE_MASK\nvec2 modUv=vec2(vUv);modUv*=2.;vec4 texelColor=texture2D(mask,modUv);gl_FragColor=vec4(texelColor.rgb,min(texelColor.a,opacity));\n#else\ngl_FragColor=vec4(diffuse,opacity);\n#endif\n}"},86676:t=>{t.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;\n#include <common>\nuniform float linewidth;uniform vec2 resolution;attribute vec3 instanceStart;attribute vec3 instanceEnd;attribute vec3 instanceColorStart;attribute vec3 instanceColorEnd;varying vec2 vUv;\n#ifdef USE_DASH\nuniform float dashScale;attribute float instanceDistanceStart;attribute float instanceDistanceEnd;varying float vLineDistance;\n#endif\nvoid trimSegment(const in vec4 start,inout vec4 end){float a=projectionMatrix[2][2];float b=projectionMatrix[3][2];float nearEstimate=-0.5*b/a;float alpha=(nearEstimate-start.z)/(end.z-start.z);end.xyz=mix(start.xyz,end.xyz,alpha);}void main(){\n#ifdef USE_COLOR\nvColor.xyz=(position.y<0.5)?instanceColorStart:instanceColorEnd;\n#endif\n#ifdef USE_DASH\nvLineDistance=(position.y<0.5)?dashScale*instanceDistanceStart:dashScale*instanceDistanceEnd;\n#endif\nfloat aspect=resolution.x/resolution.y;vUv=uv;vec4 start=modelViewMatrix*vec4(instanceStart,1.);vec4 end=modelViewMatrix*vec4(instanceEnd,1.);bool perspective=(projectionMatrix[2][3]==-1.);if(perspective){if(start.z<0.&&end.z>=0.){trimSegment(start,end);}else if(end.z<0.&&start.z>=0.){trimSegment(end,start);}}vec4 clipStart=projectionMatrix*start;vec4 clipEnd=projectionMatrix*end;vec2 ndcStart=clipStart.xy/clipStart.w;vec2 ndcEnd=clipEnd.xy/clipEnd.w;vec2 dir=ndcEnd-ndcStart;dir.x*=aspect;dir=normalize(dir);vec2 offset=vec2(dir.y,-dir.x);dir.x/=aspect;offset.x/=aspect;if(position.x<0.)offset*=-1.;offset*=linewidth;offset/=resolution.y;vec4 clip=(position.y<0.5)?clipStart:clipEnd;\n#ifdef USE_MASK\noffset*=(clipEnd.w+clipStart.w)*0.5;\n#else\noffset*=clip.w;\n#endif\nclip.xy+=offset;gl_Position=clip;\n#include <worldpos_vertex>\n}"}}]);