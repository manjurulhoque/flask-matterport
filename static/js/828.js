(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[828],{55873:(e,t,s)=>{"use strict";s.r(t),s.d(t,{BatchToggleBlurVisibilityCommand:()=>BatchToggleBlurVisibilityCommand,BlurToolChangeCommand:()=>BlurToolChangeCommand,BlurToolState:()=>i,HideBlursCommand:()=>HideBlursCommand,NavigateToBlurCommand:()=>NavigateToBlurCommand,SetBlurBrushScaleCommand:()=>SetBlurBrushScaleCommand,ShowBlursCommand:()=>ShowBlursCommand,ToggleBlurVisibilityCommand:()=>ToggleBlurVisibilityCommand,default:()=>BlurEditorModule});var i,a=s(93037);class BlurToolChangeCommand extends a.m{constructor(e){super(),this.id="BLUR_TOOL_CHANGE",this.payload={state:e}}}class SetBlurBrushScaleCommand extends a.m{constructor(e){super(),this.id="SET_BLUR_BRUSH_SCALE",this.payload={scale:e}}}class NavigateToBlurCommand extends a.m{constructor(e,t=!1){super(),this.id="NAVIGATE_TO_BLUR",this.payload={blur:e,resetBlurTool:t}}}class ToggleBlurVisibilityCommand extends a.m{constructor(e){super(),this.id="TOGGLE_BLUR_VISIBILITY",this.payload={id:e}}}class ShowBlursCommand extends a.m{constructor(...e){super(),this.id="SHOW_BLURS",this.payload={ids:e}}}class HideBlursCommand extends a.m{constructor(...e){super(),this.id="HIDE_BLURS",this.payload={ids:e}}}class BatchToggleBlurVisibilityCommand extends a.m{constructor(e){super(),this.id="BATCH_TOGGLE_BLUR_VISIBILITY",this.payload={ids:e}}}!function(e){e.OFF="off",e.IDLE="idle",e.PAINTING="painting",e.SUGGESTING="suggesting"}(i||(i={}));var n,r=s(84428),o=s(57227),l=s(14877),d=s(91183),u=s(53549),c=s(3035),h=s(70399),m=s(94113),g=s(73501),p=s(22937),b=s(56454),v=s(91885),f=s(15099),S=s(10830),B=s(42226),C=s(368),w=s(37363),y=s(22878),T=s(48730),E=s(14832),x=s(77280),I=s(63387),D=s(23676),R=s(34612),k=s(68168),O=s(25986),N=s(29410),_=s(33299),P=s(99295),A=s(74170),L=s(5477),M=s(76922),G=s(7692),U=s(591),j=s(36032),V=s(67779);!function(e){e.DISABLED="disabled",e.IDLE="idle",e.PAINTING="painting"}(n||(n={}));class SphereBrushCursor extends r.Object3D{constructor(){super(),this._radius=.1,this._thickness=.005,this.name="SphereBrushCursor";const e=new r.MeshBasicMaterial({color:16777215,side:r.DoubleSide,depthTest:!1,transparent:!0}),t=this.getGeometry();this.mesh=new r.Mesh(t,e),this.mesh.renderOrder=P.z.reticule,this.add(this.mesh)}getGeometry(){return new r.RingGeometry(this._radius,this._radius+this._thickness,64)}updateCursorMesh(){this.mesh.geometry.dispose(),this.mesh.geometry=this.getGeometry()}get radius(){return this._radius}set radius(e){this._radius=e,this.updateCursorMesh()}dispose(){this.mesh.material.dispose(),this.mesh.geometry.dispose()}}const F=new L.Z("pano-brush");class PanoBrush{constructor(e,t,s,i,a=_.o.ALL){this.sweepData=e,this.cameraData=t,this.scene=s,this.input=i,this.cameraVector=new r.Vector3,this.lastPaint=new r.Vector3,this.mouseCursorEnabled=!1,this.needsUpdate=!0,this.observables={size:new V.f(.1),scale:new V.f(.2),feather:new V.f(.1),pressure:new V.f(.1),opacity:new V.f(1),state:new V.f(n.DISABLED)},this.position=new r.Vector3,this.direction=new r.Vector3,this.sizeRange=[.1,.5],this.featherRange=[.005,.125],this.pressureRange=[.0063,.0125],this.onPointerButton=e=>e.down?this.startPainting():this.stopPainting(),this.onPointerMove=e=>{const t=(0,G.st)(this.cameraData,e.position);if(this.setPosition(t),this.state===n.PAINTING&&this.onPaint){const e=(0,I.et)(this.observables.size.value,this.sizeRange[0],this.sizeRange[1],.005,.03);if(this.lastPaint.length()>0){const t=this.direction.clone().sub(this.lastPaint).setLength(e),s=this.lastPaint.clone();for(;s.angleTo(this.direction)>e;)s.add(t).normalize(),this.lastPaint.copy(s),this.onPaint(s,this.observables.size.value,this.observables.feather.value,this.observables.pressure.value)}else this.lastPaint.copy(this.direction),this.onPaint(this.direction,this.observables.size.value,this.observables.feather.value,this.observables.pressure.value)}},this.onClick=e=>{const t=(0,G.st)(this.cameraData,e.position);this.setPosition(t),this.onPaint&&this.onPaint(this.direction,this.observables.size.value,this.observables.feather.value,this.observables.pressure.value)},this.onMouseMove=e=>{const{tagName:t}=e.target||{},s=this.mouseCursorEnabled||!t||"CANVAS"!==t?null:B.C.NONE;s!==this.mouseCursor&&(this.engine.commandBinder.issueCommand(new S.u(s)),this.mouseCursor=s)},this.brushCursor=new SphereBrushCursor,this.brushCursor.renderOrder=P.z.reticule,this.brushCursor.layers.mask=a.mask}init(){this.bindings=new j.V(this.input.registerPriorityHandler(M._t,r.Mesh,(()=>!0)),this.input.registerHandler(h.mE,this.onPointerMove),this.input.registerHandler(h.er,this.onPointerButton),this.input.registerUnfilteredHandler(c.R,this.onClick),new U.r(document.body,"mousemove",this.onMouseMove)),this.bindings.cancel()}render(){this.state!==n.DISABLED&&this.needsUpdate&&(this.brushCursor.position.copy(this.position),this.brushCursor.lookAt(this.scene.camera.getWorldPosition(this.cameraVector)),this.needsUpdate=!1)}dispose(){this.brushCursor.dispose()}activate(e){this.engine=e}deactivate(e){this.disable()}enable(){F.debug("Enabled"),this.observables.state.value=n.IDLE,this.bindings.renew(),this.scene.add(this.brushCursor)}disable(){F.debug("Disabled"),this.observables.state.value=n.DISABLED,this.bindings.cancel(),this.scene.remove(this.brushCursor),this.engine.commandBinder.issueCommand(new S.u(null))}onPropertyChanged(e,t){return this.observables[e].onChanged(t)}getSizeRange(){return this.sizeRange}setSizeRange(e,t){this.sizeRange=[e,t],this.scale=this.observables.scale.value}get scale(){return this.observables.scale.value}set scale(e){const t=(0,A.uZ)(e,0,1),s=(0,I.dS)(t,0,1,this.sizeRange[0],this.sizeRange[1]),i=(0,I.dS)(t,0,1,this.featherRange[0],this.featherRange[1]),a=(0,I.dS)(t,0,1,this.pressureRange[0],this.pressureRange[1]);this.brushCursor.radius=s,this.observables.size.value=s,this.observables.scale.value=t,this.observables.feather.value=i,this.observables.pressure.value=a,F.debug(`Set brush scale to ${100*t}% (${s})`)}get state(){return this.observables.state.value}get size(){return this.observables.size.value}set size(e){const t=(0,A.uZ)(e,this.sizeRange[0],this.sizeRange[1]),s=(0,I.dS)(t,this.sizeRange[0],this.sizeRange[1],0,1),i=(0,I.dS)(t,this.sizeRange[0],this.sizeRange[1],this.featherRange[0],this.featherRange[1]),a=(0,I.dS)(t,this.sizeRange[0],this.sizeRange[1],this.pressureRange[0],this.pressureRange[1]);this.brushCursor.radius=t,this.observables.size.value=t,this.observables.scale.value=s,this.observables.feather.value=i,this.observables.pressure.value=a,F.debug(`Set brush size to ${t} (${100*s}%)`)}toggleMouseCursor(e){this.mouseCursorEnabled=e}startPainting(){this.observables.state.value=n.PAINTING}stopPainting(){this.observables.state.value=n.IDLE,this.lastPaint.set(0,0,0)}setPosition(e){const t=this.sweepData.currentSweepObject;if(!t)return;const s=e.clone().sub(t.position).normalize(),i=t.position.clone().add(s);this.position.copy(i),this.direction.copy(s),this.needsUpdate=!0}}class BlurMesh extends r.InstancedMesh{}var z=s(70446),H=s(80122),Q=s(93093),$=s(65171);const q={brush:{uniforms:{opacity:{type:"v3",value:new r.Vector3(1,1,1)},color:{type:"c",value:new r.Color},radius:{type:"v3",value:new r.Vector3(.1,.1,.1)},feather:{type:"v3",value:new r.Vector3(0,0,0)}},vertexShader:s(682),fragmentShader:s(20959)},combineBlurs:{uniforms:{maskMatrix:{type:"m4",value:new r.Matrix4},maskTexture:{type:"t",value:null},panoMatrix1:{type:"m4",value:new r.Matrix4},panoMatrix2:{type:"m4",value:new r.Matrix4},panoBlurredMap0:{type:"t",value:null},panoBlurredMap1:{type:"t",value:null},panoBlurredMap2:{type:"t",value:null},panoBlurredMap3:{type:"t",value:null}},vertexShader:s(65697),fragmentShader:s(10385)}};var W=s(3157);const Z=new r.Matrix4;function Y(e){const t=new r.WebGLCubeRenderTarget(e,{format:r.RGBAFormat,generateMipmaps:!1,depthBuffer:!1,stencilBuffer:!1});return t.texture.image={},t.texture.image.width=e,t.texture.image.height=e,t}class BlurRenderTarget{constructor(e,t,s){this.inputSize=e,this.outputSize=t,this.sigma=s,this.input=Y(e),this.output=Y(t)}get texture(){return this.output.texture}}class BlurOverlayRenderer{constructor(e,t){this.renderToTexture=e,this.renderer=t,this.renderTarget=new r.WebGLCubeRenderTarget(2048,{format:r.RGBAFormat,generateMipmaps:!1,depthBuffer:!1,stencilBuffer:!1}),this.camera=new r.Camera,this.blurRTs=W.TW.map((e=>((e,t,s)=>{const i=new BlurRenderTarget(e,t,s);return{renderTarget:i,cubeCamera:new r.CubeCamera(.1,1e3,i.output)}})(e.size,2*e.size,e.sigma))),this.debug={};const s=r.UniformsUtils.clone(q.combineBlurs.uniforms);this.material=new r.RawShaderMaterial({fragmentShader:q.combineBlurs.fragmentShader,vertexShader:q.combineBlurs.vertexShader,uniforms:s,side:r.DoubleSide,name:"CubemapRendererMaterial"}),this.mesh=new r.Mesh(new r.BoxBufferGeometry(100,100,100),this.material),this.material.uniforms.panoBlurredMap0.value=this.blurRTs[0].renderTarget.texture,this.material.uniforms.panoBlurredMap1.value=this.blurRTs[1].renderTarget.texture,this.material.uniforms.panoBlurredMap2.value=this.blurRTs[2].renderTarget.texture,this.material.uniforms.panoBlurredMap3.value=this.blurRTs[3].renderTarget.texture,this.renderTarget.texture.image={},this.renderTarget.texture.image.height=2048,this.renderTarget.texture.image.width=2048}setDebug(e,t){t?this.debug[e]=!0:this.debug[e]&&delete this.debug[e],this.material.defines=this.debug,this.material.needsUpdate=!0,this.render()}render(){this.renderToTexture.render(this.renderTarget,this.mesh,this.camera)}get texture(){return this.renderTarget.texture}setMaskTexture(e,t=Z){this.material.uniforms.maskTexture.value=e,this.material.uniforms.maskMatrix.value.copy(t)}setPano(e,t,s=Z,i=Z){if(e!==this.currentSweepId||this.currentPanoTexture!==t){this.currentSweepId=e,this.currentPanoTexture=t;for(const e of this.blurRTs){const s=e.renderTarget,i=.5/s.input.width;this.renderer.copyCubemap(t,s.input),this.renderer.blurCubemap(s.input.texture,e.cubeCamera,s.sigma,i)}this.material.uniforms.panoMatrix1.value.copy(s),this.material.uniforms.panoMatrix2.value.copy(i)}}reset(){this.currentSweepId=null,this.currentPanoTexture=null}}class BrushMaterial extends r.RawShaderMaterial{constructor(e,t,s,i){const a=r.UniformsUtils.clone(q.brush.uniforms);a.radius.value.copy(e),a.feather.value.copy(t),a.opacity.value.copy(s),a.color.value.set(1,0,0),super(Object.assign(Object.assign({},i),{fragmentShader:q.brush.fragmentShader,vertexShader:q.brush.vertexShader,uniforms:a,side:r.FrontSide,transparent:!0,blending:r.AdditiveBlending,name:"brushMaterial"}))}get color(){return this.uniforms.color.value}set color(e){this.uniforms.color.value=e}}var K=s(19945),J=s(62029);const X=new r.Color(16711680),ee=new r.Color(65280),te=new r.Color(255);class BlurRenderer{constructor(e,t,s,i,a,n,o){this.sweepData=e,this.blurEditorData=t,this.scene=s,this.input=i,this.panoRenderer=o,this.root=new r.Group,this.meshes={},this.maskRenderTarget=new r.WebGLCubeRenderTarget(1024,{format:r.RGBAFormat,generateMipmaps:!1}),this.maskCamera=new r.Camera,this.maskBackground=new r.Mesh(new r.BoxGeometry(10,10,10),new r.MeshBasicMaterial({color:0,side:r.DoubleSide})),this.maskVisible=!1,this.dirty=!0,this.updating=!1,this.bindings=[],this.blurs=[],this.renderBlurredOverlay=(()=>{const e=new r.Matrix4,t=new r.Matrix4,s=new r.Quaternion;return async i=>{this.maskCamera.position.copy(i.position),this.maskBackground.position.copy(i.position),await this.engine.commandBinder.issueCommand(new Q.sp(this.maskRenderTarget,this.root,this.maskCamera));const a=this.maskRenderTarget.texture,n=this.panoRenderer.useTexture(i.id);e.makeRotationFromQuaternion(s.copy(i.rotation).invert()),t.makeScale(-1,1,1),this.overlayRenderer.setPano(i.id,n,e,t),this.overlayRenderer.setMaskTexture(a),this.overlayRenderer.render(),this.panoRenderer.freeTexture(i.id),await this.engine.after(z.A.Begin),await this.engine.commandBinder.issueCommand(new H.M(i.id,this.overlayRenderer.texture,new r.Quaternion))}})(),this.currentSweep=this.sweepData.currentSweepObject||null,this.overlayRenderer=new BlurOverlayRenderer(a,n)}setBlurs(e){this.blurs!==e&&(this.blurs=e,this.dirty=!0)}init(){this.root.add(this.maskBackground)}async activate(e){const[t]=await Promise.all([e.getModuleBySymbol(l.y.SETTINGS)]);this.engine=e,this.meshes={},this.bindings.push(this.blurEditorData.onChanged((()=>this.dirty=!0)),e.subscribe($.Z,(e=>{this.currentSweep=this.sweepData.getSweep(e.toSweep),this.dirty=!0})),e.subscribe(J.Xq,(()=>{this.overlayRenderer.reset(),this.currentSweep&&this.renderBlurredOverlay(this.currentSweep)}))),t.registerButton("Blur Debug","Toggle blur level coloration",(()=>{this.overlayRenderer.setDebug("DEBUG_BLUR_COLORS",!this.overlayRenderer.debug.DEBUG_BLUR_COLORS),this.currentSweep&&this.renderBlurredOverlay(this.currentSweep)})),t.registerButton("Blur Debug","Toggle blur test",(()=>{this.overlayRenderer.setDebug("DEBUG_BLUR_LEVELS",!this.overlayRenderer.debug.DEBUG_BLUR_LEVELS),this.currentSweep&&this.renderBlurredOverlay(this.currentSweep)})),this.maskRenderTarget.texture.image={},this.maskRenderTarget.texture.image.width=1024,this.maskRenderTarget.texture.image.height=1024}dispose(){this.root.traverse((e=>{e instanceof r.Mesh&&e.geometry.dispose()}))}render(){this.dirty&&!this.updating&&(this.updating=!0,this.dirty=!1,this.update().finally((()=>{this.updating=!1})))}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings.length=0}getBlursForSweep(e){return this.blurs.filter((t=>t.sweepId===e))}async update(){var e,t;if(!this.currentSweep)return;const s=this.currentSweep,a=this.getBlursForSweep(s.id),n={};for(const e of a)for(const[t,s]of e.dots.entries())n[`${e.id}-${t}`]=s;let o=!1;for(const e in this.meshes){const t=this.meshes[e];n[e]&&n[e].directions.length===t.count||(this.root.remove(t),this.input.unregisterMesh(t),delete this.meshes[e],o=!0)}const l=new r.Vector3,d=new r.Vector3,u=new r.Vector3,c=new r.Matrix4,h=new r.Vector3;for(const e of a)for(const[t,i]of e.dots.entries()){const a=`${e.id}-${t}`;if(0===i.directions.length||this.meshes[a])continue;l.set(i.radius,i.radius-i.feather,i.radius),d.set(i.feather,i.feather,i.feather),u.set(i.strength,1,i.strength);const n=new BrushMaterial(l,d,u,{defines:{USE_INSTANCING:!0},depthTest:!1,depthWrite:!1}),r=new BlurMesh((0,K.fc)(),n,i.directions.length);r.blurId=e.id,i.directions.forEach(((e,t)=>{const a=2*(i.radius+i.feather),n=se(e,s);c.lookAt(s.position,n,x.f.UP),c.scale(h.set(a,a,a)),c.setPosition(n),r.setMatrixAt(t,c)})),this.meshes[a]=r,this.root.add(r),this.input.registerMesh(r,!1),o=!0}const m=new r.Color,{toolState:g,selectedBlur:p,hoveredBlur:b}=this.blurEditorData;for(const s in this.meshes){const a=this.meshes[s],n=a.material;m.copy(X);let r=P.z.reticule+.1;const l=null===(e=null==b?void 0:b.editable)||void 0===e||e,d=null===(t=null==p?void 0:p.editable)||void 0===t||t;g!==i.PAINTING&&(l&&a.blurId===(null==b?void 0:b.id)&&(m.add(te),r=P.z.reticule+.2),d&&a.blurId===(null==p?void 0:p.id)&&(m.add(ee),r=P.z.reticule+.3)),n.color.equals(m)&&a.renderOrder===r||(n.color.copy(m),a.renderOrder=r,o=!0)}o&&await this.renderBlurredOverlay(s)}setMaskVisibility(e){this.maskVisible!==e&&(e?this.scene.add(this.root):this.scene.remove(this.root),this.maskVisible=e)}}function se(e,t){const s=e.clone().applyQuaternion(t.rotation).normalize();return t.position.clone().add(s)}var ie=s(35424),ae=s(98254),ne=s(66910);class BlurEditorState extends ae.T{constructor(){super(...arguments),this.selected=!1,this.hovered=!1}}class BlurEditorInteractions extends ae.T{constructor(){super(...arguments),this.openedTool=!1,this.createdBlur=!1}}class BlurEditorData extends ie.V{constructor(){super(...arguments),this.name="blur-editor",this.toolState=i.IDLE,this.brushCursorVisibility=!1,this.interactions=new BlurEditorInteractions,this.showMouseCursor=!1,this.states=new ne.v,this._selectedBlur=null,this._hoveredBlur=null}getState(e){let t=this.states.get(e);return t||(t=new BlurEditorState,this.states.set(e,t)),t}get selectedBlur(){return this._selectedBlur}set selectedBlur(e){if(this.selectedBlur===e)return;const t=this.selectedBlur;if(this._selectedBlur=e,this.commit(),e){const t=this.getState(e.id);t.selected=!0,t.commit()}if(t){const e=this.getState(t.id);e.selected=!1,e.commit()}}onSelectedBlurChanged(e){return this.onPropertyChanged("_selectedBlur",e)}get hoveredBlur(){return this._hoveredBlur}set hoveredBlur(e){if(this.hoveredBlur===e)return;const t=this.hoveredBlur;if(this._hoveredBlur=e,this.commit(),e){const t=this.getState(e.id);t.hovered=!0,t.commit()}if(t){const e=this.getState(t.id);e.hovered=!1,e.commit()}}onHoveredBlurChanged(e){return this.onPropertyChanged("_hoveredBlur",e)}}var re=s(19926),oe=s(43985),le=s(78114),de=s(6058),ue=s(88337),ce=s(56044),he=s(65453),me=s(10854),ge=s(18253),pe=s(73156),be=s(24486),ve=s(14279),fe=s(60649),Se=s(12622),Be=s(83233),Ce=s(19387),we=s(58843),ye=s(15032),Te=s(60591);const{SUGGESTIONS:Ee}=me.Z.WORKSHOP;class BlurToolManager{constructor(e,t){this.engine=e,this.settingsData=t,this.initialized=!1,this.toggledAssets={[ve.U]:!1,[ge.re]:!1,[pe.Mp]:!1,[he.Nj]:!1,[be.s]:!1},this.navigateToNextSuggestion=(e,t)=>{let s;for(let i=0;i<e.length;i++){const a=e[i],n=a.items.indexOf(t);if(-1!==n){const t=n+1;t<a.items.length?s=a.items[t]:e[i+1]&&e[i+1].items.length&&(s=e[i+1].items[0]);break}}s&&this.engine.commandBinder.issueCommand(new NavigateToBlurCommand(s,!1))},this.debouncedNavigateToNextSuggestion=(0,Be.D)(this.navigateToNextSuggestion,500),this.settingsToggler=new de.u(this.settingsData,this.toggledAssets)}async activate(){var e;if(!this.initialized){this.initialized=!0;const{market:e}=this.engine,[t,s,i,a,n]=await Promise.all([e.waitForData(b.f),e.waitForData(BlurEditorData),e.waitForData(ce.c),e.waitForData(fe.D),e.waitForData(w.O)]),r=new ue.Q(t.blurs);r.sort(((e,t)=>e.index-t.index)),r.priority=ue.K.LOW;const o=await e.waitForData(Ce.a),l=new ue.Q(o.suggestions);l.setFilter("accepted",(e=>null===e.accepted)),l.sort(((e,t)=>t.index-e.index)),this.dataMap={blurData:t,blurEditorData:s,blurList:r,floorsViewData:i,settings:this.settingsData,suggestionData:o,suggestionList:l,sweepViewData:a,viewmodeData:n}}const t=null===(e=this.dataMap.sweepViewData.data.currentSweepObject)||void 0===e?void 0:e.isAligned(),s=this.dataMap.viewmodeData.canStartTransition()&&this.dataMap.viewmodeData.currentMode!==y.Ey.Panorama;s&&!t&&await this.engine.commandBinder.issueCommand(new Se._i(Se.BD.INSIDE)),this.settingsToggler.toggle(!0),this.toggleBlurTool(i.IDLE),s&&t&&await this.engine.commandBinder.issueCommand(new Se._i(Se.BD.INSIDE))}async deactivate(){this.settingsToggler.toggle(!1),await this.toggleBlurTool(i.OFF)}async toggleBlurTool(e){await this.engine.commandBinder.issueCommand(new BlurToolChangeCommand(e))}async rejectAllSuggestions(){const{suggestionData:e}=this.dataMap;if(!e)return!1;const t=e.getByAccepted(null).map((e=>e.id));if(!t.length)return!1;const s=(0,ye.P)(t.length,Ee.TYPE);return await this.engine.commandBinder.issueCommand(new Te.EW(Te.Rx.DISPLAY,s))!==Te.Uc.CLOSE&&(this.engine.commandBinder.issueCommand(new we.oA(...t)),!0)}}var xe=s(85893),Ie=s(67294),De=s(61068),Re=s(94184),ke=s.n(Re),Oe=s(60405),Ne=s(57340),_e=s(87982),Pe=s(61445),Ae=s(56759);class ActionBar extends Ie.Component{addChildClasses(e){return!!e&&(0,Ie.cloneElement)(e,{className:`action-bar-item ${e.props.className||""}`})}render(){const{children:e}=this.props;return(0,xe.jsx)("div",Object.assign({className:"action-bar"},{children:Ie.Children.map(e,this.addChildClasses)}))}}var Le,Me=s(2252);!function(e){e.size="size",e.scale="scale",e.feather="feather",e.pressure="pressure",e.opacity="opacity",e.state="state"}(Le||(Le={}));var Ge=function(e,t,s,i){var a,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,i);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(r=(n<3?a(r):n>3?a(t,s,r):a(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r};const{BLURS:Ue}=me.Z.WORKSHOP;var je;!function(e){e.CREATE="create",e.BRUSH_SIZE="brushsize"}(je||(je={}));let Ve=class BlurActionBar extends Ie.Component{constructor(e){super(e),this.bindings=[],this.onToolStateChange=e=>{let{creating:t}=this.state;e===i.IDLE?t=!1:e===i.PAINTING&&(t=!0),this.setState({toolState:e,creating:t})},this.onBrushStateChange=e=>{this.setState({brushState:e})},this.onSelectedBlurChange=e=>{this.setState({selectedBlur:e})},this.onBrushSizeChange=e=>{const t=Math.round((0,I.et)(e,0,1,1,100));this.setState({brushSize:t})},this.onBrushSizeSliderChange=e=>{const{commandBinder:t}=this.context;this.dismissTooltip(je.BRUSH_SIZE);const s=(0,I.et)(e,1,100,0,1);t.issueCommand(new SetBlurBrushScaleCommand(s))},this.onDeleteClick=async()=>{const{toolState:e}=this.state;await this.deleteSelectedBlur(),e===i.PAINTING&&this.context.commandBinder.issueCommand(new BlurToolChangeCommand(i.IDLE))},this.onCreateClick=()=>{this.dismissTooltip(je.CREATE);let e=i.IDLE;this.state.toolState===i.IDLE&&(e=i.PAINTING),this.context.commandBinder.issueCommand(new BlurToolChangeCommand(e))},this.dismissTooltip=e=>{const t=Object.assign({},this.state.showTooltips);t[e]=!1,this.setState({showTooltips:t})};const{viewmodeData:t}=this.props.manager.dataMap;this.state={toolState:i.IDLE,brushState:n.DISABLED,viewmode:t.currentMode,brushSize:20,selectedBlur:null,showHints:!0,creating:!1,showTooltips:{[je.CREATE]:!0,[je.BRUSH_SIZE]:!0}}}componentDidMount(){const{blurEditorData:e,viewmodeData:t}=this.props.manager.dataMap;this.bindings.push(e.onPropertyChanged("toolState",this.onToolStateChange),e.onSelectedBlurChanged(this.onSelectedBlurChange),e.brush.onPropertyChanged(Le.scale,this.onBrushSizeChange),e.brush.onPropertyChanged(Le.state,this.onBrushStateChange),e.interactions.onPropertyChanged("createdBlur",(()=>{this.setState({showHints:!1})})),t.makeModeChangeSubscription((e=>{this.setState({viewmode:e})}))),this.onBrushSizeChange(e.brush.scale)}componentWillUnmount(){for(const e of this.bindings)e.cancel();this.bindings=[]}deleteSelectedBlur(){const{selectedBlur:e}=this.state,{commandBinder:t}=this.context;if(!e)throw new Error("Cannot delete, no Blur selected");t.issueCommand(new g.TL(e.id))}renderBrushControls(){const{brushSize:e,toolState:t}=this.state;return t!==i.PAINTING?null:(0,xe.jsxs)("div",Object.assign({className:"brush-controls"},{children:[this.renderBrushSizeTooltip(),(0,xe.jsx)("div",Object.assign({className:"brush-size-control"},{children:(0,xe.jsx)(De.ZP,{min:1,max:100,step:1,included:!0,dots:!1,value:e,onChange:this.onBrushSizeSliderChange})}))]}))}renderOverlayMessage(){const{locale:e}=this.context,{toolState:t,showHints:s}=this.state;if(!s||t!==i.PAINTING)return null;const a=e.t((0,Me.Jm)()?Ue.OVERLAY_MESSAGE_TOUCH:Ue.OVERLAY_MESSAGE);return(0,xe.jsxs)("div",Object.assign({className:"overlay-message"},{children:[(0,xe.jsx)("div",{className:"icon icon-brush-outline"}),(0,xe.jsx)("span",Object.assign({className:"message"},{children:a}))]}))}renderCreateTooltip(){const{showTooltips:e}=this.state;if(!e[je.CREATE])return null;const t=this.context.locale.t(Ue.CREATE_TOOLTIP_TITLE),s=this.context.locale.t(Ue.CREATE_TOOLTIP_MESSAGE);return(0,xe.jsx)(Ae.u,{className:"tooltip-simple-medium",open:!0,closeButton:!0,title:t,onClose:()=>this.dismissTooltip(je.CREATE),message:(0,xe.jsx)("div",Object.assign({className:"message"},{children:s})),arrowPos:Ae.x.BOTTOM_CENTER})}renderBrushSizeTooltip(){const{showTooltips:e}=this.state;if(!e[je.BRUSH_SIZE])return null;const t=this.context.locale.t(Ue.BRUSH_TOOLTIP_TITLE),s=this.context.locale.t(Ue.BRUSH_TOOLTIP_MESSAGE);return(0,xe.jsx)(Ae.u,{className:"tooltip-simple-medium",open:!0,closeButton:!0,title:t,onClose:()=>this.dismissTooltip(je.BRUSH_SIZE),message:(0,xe.jsx)("div",Object.assign({className:"message"},{children:s})),arrowPos:Ae.x.BOTTOM_CENTER})}render(){const{locale:e}=this.context,{brushState:t,toolState:s,selectedBlur:a,viewmode:r}=this.state,o=s===i.PAINTING&&a?"icon-checkmark":"icon-plus",l=Pe.BN.ENABLED,d=r===y.Ey.Panorama?Pe.BN.ENABLED:Pe.BN.DISABLED,u=ke()("overlay-cta-btn",{"overlay-cta-cancel":s===i.PAINTING&&!a}),c=ke()("overlay blur-tool-overlay",{painting:t===n.PAINTING}),h=s===i.SUGGESTING,m=a&&e.t(h?Ue.SUGGESTED_BLUR:Ue.DEFAULT_BLUR_NAME,{number:a.index});return(0,xe.jsxs)("div",Object.assign({className:c},{children:[a&&(0,xe.jsx)("div",Object.assign({className:"overlay-top-center"},{children:(0,xe.jsx)("div",Object.assign({className:"overlay-info"},{children:m}))})),!h&&(0,xe.jsxs)(xe.Fragment,{children:[this.renderOverlayMessage(),(0,xe.jsxs)(ActionBar,{children:[(0,xe.jsxs)("div",Object.assign({className:"overlay-cta"},{children:[this.renderCreateTooltip(),(0,xe.jsx)(_e.hU,{className:u,iconClass:o,buttonStyle:_e.Dd.PRIMARY,buttonState:d,onClick:this.onCreateClick}),a&&a.editable&&(0,xe.jsx)(_e.hU,{className:"overlay-cta-button-outer",buttonStyle:_e.Dd.OVERLAY,iconClass:"icon-delete",buttonState:l,onClick:this.onDeleteClick})]})),this.renderBrushControls()]})]})]}))}};Ve.contextType=Oe.I,Ve=Ge([Ne.Z],Ve);var Fe=s(46317),ze=s(14374);function He(e){const t=(0,ze.N)();return(0,Ie.useEffect)((()=>{t();const s=e.onChanged(t);return()=>{s.cancel()}}),[e,t]),e}var Qe,$e=s(68077),qe=s(41345),We=s(20585),Ze=s(35935),Ye=s(26301),Ke=s(13855),Je=s(34506);!function(e){e.SCANS="scans",e.FLOORS="floors"}(Qe||(Qe={}));const{BLURS:Xe}=me.Z.WORKSHOP,et=({value:e,onChange:t})=>{const s=(0,qe.b)(),i=[{text:s.t(Xe.BLUR_STATUS_ALL),value:"all",selected:"all"===e},{text:s.t(Xe.BLUR_STATUS_PENDING),value:v.Q.PENDING,selected:e===v.Q.PENDING},{text:s.t(Xe.BLUR_STATUS_APPLIED),value:v.Q.APPLIED,selected:e===v.Q.APPLIED},{text:s.t(Xe.BLUR_STATUS_FAILED),value:v.Q.FAILED,selected:e===v.Q.FAILED}];return(0,xe.jsx)(Je.S,{className:"blur-filter blur-filter-status",menuStyle:Je.K.DROPDOWN,onChange:t,options:i,placeholder:s.t(Xe.STATUS)})},tt=({value:e,onChange:t})=>{const s=(0,qe.b)(),i=[{text:s.t(Xe.GROUP_BY_SCAN),value:Qe.SCANS,selected:e===Qe.SCANS},{text:s.t(Xe.GROUP_BY_FLOOR),value:Qe.FLOORS,selected:e===Qe.FLOORS}];return(0,xe.jsx)(Je.S,{className:"blur-filter blur-filter-groupby",menuStyle:Je.K.DROPDOWN,onChange:t,options:i,placeholder:s.t(Xe.GROUP_BY)})},st=({value:e,onChange:t})=>{const s=(0,qe.b)(),i=[{text:s.t(Xe.SORT_CREATED_DESC),value:"CREATED_DESC",selected:"CREATED_DESC"===e},{text:s.t(Xe.SORT_CREATED_ASC),value:"CREATED_ASC",selected:"CREATED_ASC"===e}];return(0,xe.jsx)(Je.S,{className:"blur-filter blur-filter-sort",menuStyle:Je.K.DROPDOWN,onChange:t,options:i,placeholder:s.t(Xe.SORT)})};var it=s(80312),at=s(25379),nt=s(98807),rt=s(20302);const ot=(0,rt.u)(BlurEditorData);function lt(){const[e,t]=(0,Ie.useState)(null),s=ot();return(0,Ie.useEffect)((()=>{const e=[];return s&&(e.push(s.onSelectedBlurChanged((e=>t(e)))),t(s.selectedBlur)),()=>{e.forEach((e=>e.cancel()))}}),[s]),e}function dt(){const[e,t]=(0,Ie.useState)(null),s=ot();return(0,Ie.useEffect)((()=>{const e=[];return s&&(e.push(s.onHoveredBlurChanged((e=>t(e)))),t(s.hoveredBlur)),()=>{e.forEach((e=>e.cancel()))}}),[s]),e}const{BLURS:ut}=me.Z.WORKSHOP;function ct({blur:e}){const{commandBinder:t}=(0,Ie.useContext)(Oe.I),s=ot(),i=lt(),a=dt(),n=(0,qe.b)(),r=(0,it.z)(),o=(0,Ie.useCallback)((()=>{t.issueCommand(new NavigateToBlurCommand(e,!0))}),[t,e]),l=(0,Ie.useCallback)((()=>{const s=e.visible;s?t.issueCommand(new HideBlursCommand(e.id)):t.issueCommand(new ShowBlursCommand(e.id)),r.trackToolGuiEvent("blur","blur_list_click_"+(s?"hide":"show"))}),[t,e,r]),d=(0,Ie.useCallback)((()=>{t.issueCommand(new g.TL(e.id)),r.trackToolGuiEvent("blur","blur_list_click_delete")}),[t,e,r]),u=(0,Ie.useCallback)((()=>{s&&(s.hoveredBlur=e)}),[e,s]),c=(0,Ie.useCallback)((()=>{s&&(s.hoveredBlur=null)}),[s]),h=(0,xe.jsxs)("span",{children:[n.t(ut.DEFAULT_BLUR_NAME,{number:e.index}),e.status!==v.Q.PENDING&&(0,xe.jsx)("span",Object.assign({className:"blur-status"},{children:e.status}))]}),m=(0,xe.jsxs)(Ye.hE,{children:[e.status!==v.Q.APPLIED&&(0,xe.jsx)(nt.Z,{id:e.id,visible:e.visible,showTooltip:ut.SHOW_LIST_ITEM_TOOLTIP_MESSAGE,hideTooltip:ut.HIDE_LIST_ITEM_TOOLTIP_MESSAGE,onClick:l}),(0,xe.jsx)(at.n,{id:e.id,disabled:!e.editable,menu:[[ut.DELETE_BLUR_CTA,d]],closeOnMenuItemClick:!0,accordion:!0})]}),p=ke()("blur-list-item",{active:i&&i.id===e.id},{hover:a&&a.id===e.id});return(0,xe.jsx)(Ye.HC,{className:p,onClick:o,onMouseEnter:u,onMouseLeave:c,actions:m,title:h})}const ht="other",{BLURS:mt,SCANS:gt,VIEWS_360:pt}=me.Z.WORKSHOP;function bt(e,t){const[s,i]=(0,Ie.useState)(Qe.SCANS),[a,n]=(0,Ie.useState)([]),r=(0,qe.b)(),o=(0,Ie.useCallback)((()=>{const{sweepViewData:s}=t.dataMap,i=s.getAlignedSweeps(!1),a={};if(e){const t=e.groupBy("sweepId");for(const e in t){const n=s.getSweep(e);let o=r.t(gt.LIST_ITEM_TEXT,n.index+1);if(!n.isAligned()){const e=i.findIndex((e=>e.id===n.id))||0;o=n.name||r.t(pt.DEFAULT_NAME,{index:e+1})}a[e]={id:`sweep-${n.id}`,data:n,title:o,items:t[e]}}}return a}),[e,r,t.dataMap]),l=(0,Ie.useCallback)((()=>{const{floorsViewData:s}=t.dataMap,i={};if(e){const t=e.groupBy("floorId");s.floors.iterate((e=>{i[e.id]={id:e.id,data:e,title:e.name,items:t[e.id]||[]}})),t.null&&(i.other={id:ht,title:r.t(mt.OTHER_GROUP_LABEL),items:t.null})}return i}),[e,r,t.dataMap]),d=(0,Ie.useCallback)((()=>{const e=s===Qe.SCANS?o():l(),t=Object.values(e).sort(((e,t)=>e.title.localeCompare(t.title,void 0,{numeric:!0})));n(t)}),[o,l,s]);return(0,Ie.useEffect)((()=>{const t=[e.onChanged((()=>{d()}))];return d(),()=>{t.forEach((e=>e.cancel()))}}),[e,s,r,t.dataMap,d]),{groups:a,groupBy:s,setGroupBy:i}}const vt=(0,rt.u)(Ce.a);const{BLURS:ft}=me.Z.WORKSHOP;let St=!1;const Bt=()=>{const e=function(){const e=vt(),[t,s]=(0,Ie.useState)(0);return(0,Ie.useEffect)((()=>{if(!e)return()=>{};const t=()=>{s(e.getByAccepted(null).length)},i=e.onChanged(t);return t(),()=>i.cancel()}),[e]),t}(),{commandBinder:t}=(0,Ie.useContext)(Oe.I),s=(0,qe.b)(),a=(0,it.z)(),n=(0,Ie.useCallback)((()=>{a.trackToolGuiEvent("blur","blur_click_view_suggestions"),t.issueCommand(new BlurToolChangeCommand(i.SUGGESTING))}),[t,a]);if(!e)return null;const r=s.t(ft.SUGGESTIONS_AVAILABLE_MESSAGE,e),o=(0,xe.jsxs)(Ye.zx,Object.assign({size:Ye.qE.SMALL,variant:Ye.Wu.SECONDARY,onClick:n},{children:[(0,xe.jsx)(Ye.o3,{}),(0,xe.jsx)("span",{children:s.t(ft.VIEW_SUGGESTIONS)})]}));return St||(St=!0,a.trackToolGuiEvent("blur","blur_suggestions_banner_shown")),(0,xe.jsx)(Ye.jL,{layout:"horizontal",text:r,actions:o,className:"blur-list-banner"})};var Ct=s(57599);const{BLURS:wt}=me.Z.WORKSHOP,yt=({group:e})=>{const{id:t,title:s,items:i}=e;return(0,xe.jsx)(Ct.u,{group:{name:s,id:t,items:i}})},Tt=({group:e})=>{const{id:t,title:s,items:i}=e;return(0,xe.jsx)(Ye._m,{id:t,title:`${s} (${i.length})`})},Et=({item:e})=>{const t=(0,qe.b)();if(!e){const e=t.t(wt.MULTI_FLOOR_EMPTY_MESSAGE);return(0,xe.jsx)(Ye.gQ,{message:e})}return(0,xe.jsx)(ct,{blur:e})},xt=({className:e="",manager:t})=>{const{blurList:s}=t.dataMap,i=(0,qe.b)(),a=(0,it.z)(),[n,r]=(0,Ie.useState)(null),{groups:o,groupBy:l,setGroupBy:d}=bt(s,t),u=(0,Ie.useCallback)((e=>{(0,Ke.p)(v.Q,e)?s.setFilter("status",(t=>t.status===e)):s.clearFilter("status"),null!==e&&a.trackToolGuiEvent("blur",`blur_list_filter_by_${e}`),r(e)}),[s,a]),[c,h]=(0,Ie.useState)(null),m=(0,Ie.useCallback)((e=>{switch(e){case"CREATED_DESC":s.sort(((e,t)=>e.created.getTime()-t.created.getTime()||e.index-t.index));break;case"CREATED_ASC":s.sort(((e,t)=>t.created.getTime()-e.created.getTime()||t.index-e.index))}null!==e&&a.trackToolGuiEvent("blur",`blur_list_sort_by_${e.toLowerCase()}`),h(e)}),[s,a]),g=(0,Ie.useCallback)((e=>{a.trackToolGuiEvent("blur",`blur_list_group_by_${e.toLowerCase()}`),d(e)}),[d,a]),p=ke()(e,"blur-list"),b=i.t(wt.NO_BLURS);return(0,xe.jsxs)("div",Object.assign({className:p},{children:[(0,xe.jsxs)("header",Object.assign({className:"blur-list-header"},{children:[(0,xe.jsx)(Bt,{}),(0,xe.jsxs)(Ye.w0,{children:[(0,xe.jsx)(tt,{value:l,onChange:g}),(0,xe.jsx)(et,{value:n,onChange:u}),(0,xe.jsx)(st,{value:c,onChange:m})]})]})),(0,xe.jsx)("div",Object.assign({className:"blur-list-content"},{children:0===o.length?(0,xe.jsx)(Ye.gQ,{message:b,itemHeight:60}):(0,xe.jsx)(Ye.UQ,{data:o,itemHeight:60,renderItem:Et,renderGroup:l===Qe.FLOORS?yt:Tt})}))]}))};const{BLURS:It}=me.Z.WORKSHOP,Dt=({suggestion:e,onResolved:t})=>{const{commandBinder:s}=(0,Ie.useContext)(Oe.I),i=(0,it.z)(),a=(0,qe.b)(),n=ot(),r=dt(),o=lt(),[l,d]=(0,Ie.useState)(null),u=(0,Ie.useCallback)((()=>{s.issueCommand(new we.rf(e.id)),i.trackToolGuiEvent("blur","blur_suggestion_list_click_accept"),t(e,!0)}),[i,s,e,t]),c=(0,Ie.useCallback)((()=>{s.issueCommand(new we.oA(e.id)),i.trackToolGuiEvent("blur","blur_suggestion_list_click_reject"),t(e,!1)}),[i,s,e,t]),h=(0,Ie.useCallback)((e=>{l||(d("accepted"),setTimeout(u,500),e.stopPropagation())}),[u,l]),m=(0,Ie.useCallback)((e=>{l||(d("rejected"),setTimeout(c,500),e.stopPropagation())}),[c,l]),g=(0,Ie.useCallback)((t=>{const a=e.visible;a?s.issueCommand(new we.mA(e.id)):s.issueCommand(new we.ee(e.id)),i.trackToolGuiEvent("blur","blur_suggestion_list_click_"+(a?"hide":"show")),t.stopPropagation()}),[i,s,e]),p={placement:"top"},b=(0,Ie.useCallback)((()=>{n&&(n.hoveredBlur=e)}),[e,n]),v=(0,Ie.useCallback)((()=>{n&&(n.hoveredBlur=null)}),[n]),f=(0,xe.jsxs)(Ye.hE,{children:[(0,xe.jsx)(Ye.zx,{icon:e.visible?"eye-show":"eye-hide",onClick:g,tooltip:e.visible?a.t(It.HIDE_LIST_ITEM_TOOLTIP_MESSAGE):a.t(It.SHOW_LIST_ITEM_TOOLTIP_MESSAGE),tooltipOptions:p}),(0,xe.jsx)(Ye.zx,{icon:"checkmark",onClick:h,tooltip:a.t(It.ACCEPT_SUGGESTION_TOOLTIP),tooltipOptions:p}),(0,xe.jsx)(Ye.zx,{icon:"close",onClick:m,tooltip:a.t(It.REJECT_SUGGESTION_TOOLTIP),tooltipOptions:p})]}),S=a.t(It.SUGGESTED_BLUR,{number:e.index}),B=ke()("blur-suggestion-list-item",{active:o&&o.id===e.id,hover:r&&r.id===e.id,accepted:"accepted"===l,rejected:"rejected"===l});return(0,xe.jsx)(Ye.HC,{actions:f,className:B,title:S,onClick:()=>{s.issueCommand(new NavigateToBlurCommand(e,!1))},onMouseEnter:b,onMouseLeave:v})},{BLURS:Rt}=me.Z.WORKSHOP,kt=({onClose:e,manager:t})=>{const s=(0,qe.b)(),i=(0,it.z)(),{commandBinder:a}=(0,Ie.useContext)(Oe.I),{suggestionList:n}=t.dataMap,r=(0,Ie.useCallback)((()=>{a.issueCommand(new we.rf),i.trackToolGuiEvent("blur","blur_suggestion_list_click_accept_all"),e()}),[a,e,i]),o=(0,Ie.useCallback)((async()=>{await t.rejectAllSuggestions()&&(i.trackToolGuiEvent("blur","blur_suggestion_list_click_reject_all"),e())}),[t,e,i]);if(!(null==n?void 0:n.length))return null;const l=n.length,d=s.t(Rt.SUGGESTIONS_FOUND_MESSAGE,l),u=(0,xe.jsxs)(Ye.hE,Object.assign({spacing:"small"},{children:[(0,xe.jsx)(Ye.zx,{variant:Ye.Wu.PRIMARY,size:Ye.qE.SMALL,onClick:r,label:s.t(Rt.ACCEPT_ALL_SUGGESTIONS)}),(0,xe.jsx)(Ye.zx,{variant:Ye.Wu.TERTIARY,size:Ye.qE.SMALL,onClick:o,label:s.t(Rt.REJECT_ALL_SUGGESTIONS)})]})),c=(0,xe.jsx)(Ye.zx,{size:Ye.qE.LARGE,variant:Ye.Wu.TERTIARY,onClick:e,className:"blur-banner-exit",icon:"back",label:s.t(Rt.CLOSE_SUGGESTIONS)});return(0,xe.jsx)("div",Object.assign({className:"suggestion-list-header"},{children:(0,xe.jsx)(Ye.jL,{text:d,actions:u,header:c})}))},{BLURS:Ot}=me.Z.WORKSHOP,Nt=({group:e})=>{const{id:t,title:s,items:i}=e;return(0,xe.jsx)(Ye._m,{id:t,title:`${s} (${i.length})`})},_t=({group:e})=>{const{id:t,title:s,items:i}=e;return(0,xe.jsx)(Ct.u,{group:{name:s,id:t,items:i}})},Pt=({item:e,onResolved:t})=>{const s=(0,qe.b)();if(!e){const e=s.t(Ot.NO_SUGGESTIONS_ON_FLOOR);return(0,xe.jsx)(Ye.gQ,{message:e})}return(0,xe.jsx)(Dt,{suggestion:e,onResolved:t})},At=({className:e,manager:t,onClose:s})=>{const{suggestionList:i}=t.dataMap,a=(0,it.z)(),n=(0,qe.b)(),{groups:r,groupBy:o,setGroupBy:l}=bt(i,t),d=(0,Ie.useCallback)((e=>{a.trackToolGuiEvent("blur",`blur_suggestion_list_group_by_${e.toLowerCase()}`),l(e)}),[a,l]),u=(0,Ie.useCallback)(((e,s)=>{t.debouncedNavigateToNextSuggestion(r,e)}),[t,r]);if(!i)return null;const c=ke()(e,"suggestion-list"),h=n.t(Ot.NO_SUGGESTIONS);return(0,xe.jsxs)("div",Object.assign({className:c},{children:[(0,xe.jsxs)("header",Object.assign({className:"suggestion-list-header"},{children:[(0,xe.jsx)(kt,{manager:t,onClose:s}),(0,xe.jsx)(Ye.w0,{children:(0,xe.jsx)(tt,{value:o,onChange:d})})]})),(0,xe.jsx)("div",Object.assign({className:"suggestion-list-content"},{children:0===r.length?(0,xe.jsx)(Ye.gQ,{message:h,itemHeight:42}):(0,xe.jsx)(Ye.UQ,{data:r,itemHeight:42,renderItem:Pt,renderItemProps:{onResolved:u},renderGroup:o===Qe.FLOORS?_t:Nt})}))]}))};var Lt=s(76632);const{BLURS:Mt}=me.Z.WORKSHOP;function Gt({manager:e,className:t}){const s=He(e.dataMap.blurList),a=He(e.dataMap.suggestionList),{commandBinder:n}=(0,Ie.useContext)(Oe.I),r=(0,qe.b)(),o=function(){const e=ot(),[t,s]=(0,Ie.useState)(i.OFF);return(0,Ie.useEffect)((()=>{const t=[];if(e){const i=()=>{s(e.toolState)};t.push(e.onPropertyChanged("toolState",i)),i()}return()=>{t.forEach((e=>e.cancel()))}}),[e]),t}(),l=(0,$e.y)(We.Bg,!1),d=o===i.SUGGESTING,u=ke()(t,"blurs-panel"),c=(0,Ie.useCallback)((e=>{const t=d?i.IDLE:i.SUGGESTING;n.issueCommand(new BlurToolChangeCommand(t)),e&&e.stopPropagation()}),[d,n]),h=d?r.t(Mt.NUM_BLUR_SUGGESTIONS,a.length):r.t(Mt.NUM_TYPE,s.length),m=!d&&l?(0,xe.jsx)(Lt._,{}):void 0,g=d?void 0:(0,xe.jsx)(Ze.z,{toolId:D.w1.BLUR});return(0,xe.jsxs)(Fe.L,Object.assign({active:!0,toolId:D.w1.BLUR,className:u,title:h,controls:m,subheader:g},{children:[d&&(0,xe.jsx)(At,{className:"blurs-panel-contents",manager:e,onClose:c}),!d&&(0,xe.jsx)(xt,{className:"blurs-panel-contents",manager:e})]}))}class BlurToolUi{constructor(e,t){this.renderPanel=()=>(0,xe.jsx)(Gt,{manager:this.manager}),this.renderActionBar=()=>(0,xe.jsx)(Ve,{manager:this.manager}),this.manager=e}}var Ut=s(61903),jt=s(48697),Vt=s(52012),Ft=s(94772);class BlurEditorModule extends o.Y{constructor(){super(...arguments),this.name="blur_editor",this.activeBindings=[],this.setMeshCursorVisibility=()=>!this.data.hoveredBlur&&this.data.toolState!==i.PAINTING,this.changeToolState=async e=>{const t=this.data.toolState;e!==t&&(this.data.toolState=e,this.data.commit(),await this.onToolStateChange(e,t))},this.navigateToBlur=(e,t)=>{if(!e)throw new Error("Cannot navigate to non-existant blur");let s;const a=this.getFocalPoint(e.dots);if(a){const t=this.sweepData.getSweep(e.sweepId);a.applyQuaternion(t.rotation),s=(0,I.Z)((new r.Quaternion).setFromUnitVectors(x.f.FORWARD,a))}const n=new T.ju({transition:E.n.Interpolate,sweep:e.sweepId,rotation:s}),o=this.engine.commandBinder.issueCommand(n).then((()=>{this.data.selectedBlur=e||null}));return t&&this.engine.commandBinder.issueCommand(new BlurToolChangeCommand(i.IDLE)),this.toolData.toolPanelLayout===D.wS.BOTTOM_PANEL&&this.engine.commandBinder.issueCommand(new R.Fg(!0)),o},this.onToolStateChange=async(e,t)=>{const{brush:s}=this.data;t===i.PAINTING&&await this.engine.commandBinder.issueCommand(new g.o8),e===i.PAINTING?(s.enable(),this.engine.broadcast(new k.ps(!1))):(s.disable(),this.engine.broadcast(new k.ps(!0))),e===i.OFF?(this.activeBindings.forEach((e=>e.cancel())),this.data.selectedBlur=null,this.data.hoveredBlur=null,this.data.interactions.openedTool=!1,this.data.interactions.commit(),this.renderer.setBlurs([])):this.activeBindings.forEach((e=>e.renew())),e!==i.OFF&&(this.data.selectedBlur=null,this.data.hoveredBlur=null,this.data.interactions.openedTool||(this.data.interactions.openedTool=!0,this.data.interactions.commit()),e===i.SUGGESTING?this.renderSuggestions():this.renderBlurs()),this.updatePolling()},this.checkForUpdates=()=>{let e;return(0,d.k1)((()=>{clearInterval(e),e=window.setInterval((()=>{this.log.debug("Polling..."),this.engine.commandBinder.issueCommand(new g.s$)}),1e3*le.F8)}),(()=>{window.clearInterval(e)}),!1)},this.onViewmodeChange=e=>{const{toolState:t}=this.data;e!==y.Ey.Panorama&&t===i.PAINTING&&this.changeToolState(i.IDLE),e===y.Ey.Panorama?this.clickHandler.renew():this.clickHandler.cancel()},this.onSweepChange=e=>{const{selectedBlur:t}=this.data;t&&(this.onDeselectBlur(t),this.data.selectedBlur=null)},this.onBlursChanged=()=>{const{selectedBlur:e}=this.data;e&&!this.blurData.isEditable(e.id)&&(this.data.selectedBlur=null);const{toolState:t}=this.data;t!==i.SUGGESTING&&this.renderBlurs()},this.onSuggestionsChanged=()=>{const e=this.toolData.getTool(D.w1.BLUR);if(e){const t=this.suggestionData.getByAccepted(null).length>0;e.hasUpdates!==t&&(e.hasUpdates=t,e.commit())}if(!this.data)return;const{toolState:t}=this.data;t===i.SUGGESTING&&this.renderSuggestions()},this.onPointerButton=e=>{const{toolState:t}=this.data,{hit:s}=this.raycasterData;e.down&&t===i.PAINTING&&this.updateSelectedBlur(s?s.object:null)},this.onKeyEvent=e=>{const{selectedBlur:t}=this.data;if(t&&e.state===re.M.PRESSED)switch(e.key){case oe.R.ESCAPE:this.engine.commandBinder.issueCommand(new BlurToolChangeCommand(i.IDLE));break;case oe.R.DELETE:this.data.selectedBlur&&this.engine.commandBinder.issueCommand(new g.TL(t.id))}},this.onClick=(e,t)=>{const{toolState:s}=this.data;return s===i.PAINTING||!!(t instanceof BlurMesh||this.data.selectedBlur)&&(this.updateSelectedBlur(t),!0)},this.onPaint=(e,t,s,i)=>{const a=this.sweepData.currentSweepObject;if(!a)return;let n=this.data.selectedBlur instanceof p.x?this.data.selectedBlur:null;const r=n?n.dotCount:0;(!n||r>le.Vw)&&(n=new p.x({sweepId:a.id}),a.placementType!==Ft.hU.UNPLACED&&(n.floorId=a.floorId,n.roomId=a.roomId),this.blurData.add(n),this.data.selectedBlur=n);const o=e.clone().applyQuaternion(a.rotation.clone().invert()).normalize();n.add(o,t,s,i)},this.updateHoveredBlur=()=>{const{toolState:e}=this.data,t=this.raycasterData.hit&&this.raycasterData.hit.object,s=e===i.PAINTING?null:this.getBlurFromMesh(t);if(s!==this.data.hoveredBlur&&(this.data.hoveredBlur=s,this.data.toolState!==i.PAINTING)){const e=s?B.C.FINGER:null;this.engine.commandBinder.issueCommand(new S.u(e))}}}async init(e,t){this.log.debug("Module config",e),this.engine=t,this.config=e,[this.blurData,this.cameraData,this.cursorController,this.raycasterData,this.settings,this.storageData,this.sweepData,this.toolData,this.viewmodeData]=await Promise.all([t.market.waitForData(b.f),t.market.waitForData(f.M_),t.getModuleBySymbol(l.y.CURSOR_CONTROLLER),t.market.waitForData(C.P),t.getModuleBySymbol(l.y.SETTINGS),t.market.waitForData(jt.Q),t.market.waitForData(u.Z),t.market.waitForData(O.t),t.market.waitForData(w.O)]);const[s,a,n,o]=await Promise.all([t.getModuleBySymbol(l.y.INPUT),t.getModuleBySymbol(l.y.RENDER_TO_TEXTURE),t.market.waitForData(w.O),t.getModuleBySymbol(l.y.WEBGL_RENDERER)]);this.suggestionData=await t.market.waitForData(Ce.a),this.bindings.push(this.toolData.onChanged(this.onSuggestionsChanged),this.suggestionData.onChanged(this.onSuggestionsChanged));const d=(await t.getModuleBySymbol(l.y.SWEEP_PANO)).getRenderer();this.data=new BlurEditorData,t.market.register(this,BlurEditorData,this.data),this.cursorController.addVisibilityRule(this.setMeshCursorVisibility);const g=o.getScene();this.renderer=new BlurRenderer(this.sweepData,this.data,g,s,a,o.cwfRenderer,d),t.addComponent(this,this.renderer);const p=new PanoBrush(this.sweepData,this.cameraData,g,s);p.setSizeRange(le.oR,le.rC),p.onPaint=this.onPaint,t.addComponent(this,p),this.data.brush=p,this.registerSettings(),this.registerTool(),this.clickHandler=s.registerPriorityHandler(c.R,r.Mesh,this.onClick),this.bindings.push(t.commandBinder.addBinding(BlurToolChangeCommand,(async e=>this.changeToolState(e.state))),t.commandBinder.addBinding(SetBlurBrushScaleCommand,(async e=>this.data.brush.scale=e.scale)),t.commandBinder.addBinding(NavigateToBlurCommand,(async({blur:e,resetBlurTool:t})=>this.navigateToBlur(e,t))),t.commandBinder.addBinding(ShowBlursCommand,(({ids:e})=>this.showBlurs(...e))),t.commandBinder.addBinding(HideBlursCommand,(({ids:e})=>this.hideBlurs(...e))),t.commandBinder.addBinding(ToggleBlurVisibilityCommand,(async({id:e})=>this.batchToggleVisibility([e]))),t.commandBinder.addBinding(BatchToggleBlurVisibilityCommand,(async({ids:e})=>this.batchToggleVisibility(e)))),this.pollingSubscription=this.checkForUpdates(),this.updatePolling(),this.activeBindings.push(n.makeModeChangeSubscription(this.onViewmodeChange),this.sweepData.makeSweepChangeSubscription(this.onSweepChange),this.blurData.blurs.onChanged(this.onBlursChanged),s.registerHandler(h.er,this.onPointerButton),s.registerHandler(m.e,this.onKeyEvent),this.raycasterData.onChanged(this.updateHoveredBlur),this.clickHandler,this.storageData.onPropertyChanged("transactionState",(()=>this.updatePolling())),this.blurData.makeProcessingSubscription((()=>this.updatePolling()))),this.changeToolState(i.OFF),this.viewmodeData.currentMode&&this.onViewmodeChange(this.viewmodeData.currentMode),e.debug&&this.log.info("DEBUG mode enabled")}dispose(e){super.dispose(e),this.pollingSubscription&&this.pollingSubscription.cancel(),this.activeBindings.forEach((e=>e.cancel())),e.disposeRenderLayer(this.name),this.data&&e.market.unregister(this,BlurEditorData),this.cursorController.removeVisibilityRule(this.setMeshCursorVisibility)}renderBlurs(){const e=this.blurData.getByStatus(v.Q.PENDING,v.Q.PROCESSING,v.Q.FAILED).filter((e=>e.visible));this.renderer.setBlurs(e)}renderSuggestions(){const e=this.suggestionData.getByAccepted(!0,null).filter((e=>e.visible));this.renderer.setBlurs(e)}getFocalPoint(e){if(!e.length)return null;let t=0;const s=e.reduce(((e,s)=>{for(const i of s.directions)e.x+=i.x,e.y+=i.y,e.z+=i.z,t++;return e}),{x:0,y:0,z:0});return new r.Vector3(s.x/t,s.y/t,s.z/t)}async showBlurs(...e){this.blurData.setVisibility(!0,...e)}async hideBlurs(...e){this.blurData.setVisibility(!1,...e)}batchToggleVisibility(e){this.blurData.batchToggleVisibility(e)}updatePolling(){const{toolState:e}=this.data,{transactionState:t}=this.storageData,s=e!==i.OFF,a=t===Vt.g.IDLE;return s&&a?(this.pollingSubscription.renew(),this.log.debug("Polling enabled"),!0):(this.log.debug("Polling disabled"),this.pollingSubscription.cancel(),!1)}onDeselectBlur(e){const{toolState:t}=this.data;e&&t===i.PAINTING&&this.engine.commandBinder.issueCommand(new g.o8)}getBlurFromMesh(e){if(e&&e instanceof BlurMesh){const t=this.data.toolState===i.SUGGESTING,s=t?this.suggestionData.get(e.blurId):this.blurData.get(e.blurId);if(t||(null==s?void 0:s.status)===v.Q.PENDING)return s}return null}updateSelectedBlur(e){const t=this.getBlurFromMesh(e);t!==this.data.selectedBlur&&(this.onDeselectBlur(this.data.selectedBlur),this.data.selectedBlur=t,t&&this.log.debug(`Selected blur ${t.id}`))}registerSettings(){const e="Blur Tool",{brush:t}=this.data,{debug:s,meshBlurEnabled:i,pipelineEnabled:a}=this.config;[{header:e,setting:"blur/brush_size",range:[le.oR,le.rC],initialValue:()=>t.size,onChange:e=>t.size=e},{header:e,setting:"blur/brush_scale",range:[0,1],initialValue:()=>t.scale,onChange:e=>t.scale=e},{header:e,setting:"blur/tool_enabled",initialValue:()=>this.settings.tryGetProperty(le.x3,!1),onChange:e=>this.settings.updateSetting(le.x3,e)},{header:e,setting:"blur/mask",initialValue:()=>!1,onChange:e=>{this.renderer&&this.renderer.setMaskVisibility(e)}},{header:e,setting:"blur/show_cursor",initialValue:()=>!1,onChange:e=>{this.log.debug("Brush mouse cursor "+(e?"enabled":"disabled")),t.toggleMouseCursor(e)}},{header:e,setting:le.Vk,initialValue:()=>s,onChange:e=>{this.settings.updateSetting(le.Vk,e)}},{header:e,setting:W.pv,initialValue:()=>!1,onChange:e=>{this.settings.updateSetting(W.pv,e)}},{header:e,setting:W.n5,initialValue:()=>a,onChange:e=>{this.settings.updateSetting(W.n5,e)}},{header:e,setting:W.i7,initialValue:()=>i,onChange:e=>{this.settings.updateSetting(W.i7,e)}}].forEach((e=>this.settings.registerMenuEntry(e)))}async registerTool(){const e=await this.engine.market.waitForData(Ut.e),t=new BlurToolManager(this.engine,e),s=new N.U({id:D.w1.BLUR,namePhraseKey:me.Z.TOOLS.BLUR,panel:!0,icon:"icon-blur-outline",analytic:"blur",toolbar:!0,palette:D.$r.MODEL_BASED,allViewsPhraseKey:me.Z.WORKSHOP.LAYERS.APPLY_TO_ALL_VIEWS_BLURS,order:90,dimmed:!1,enabled:e.tryGetProperty(le.x3,!1),manager:t,ui:new BlurToolUi(t,e),featureFlag:le.x3,helpMessagePhraseKey:me.Z.TOOLS.BLUR_HELP_MESSAGE,helpHref:"https://support.matterport.com/hc/en-us/articles/1500003156162-How-to-use-Manual-Blur-Brush"});this.engine.commandBinder.issueCommand(new R.MV([s]))}}},19387:(e,t,s)=>{"use strict";s.d(t,{a:()=>BlurSuggestionData});var i=s(35424),a=s(66910),n=s(81402);class BlurSuggestionData extends i.V{constructor(e){super(),this.name="blur-suggestion-data",this.suggestions=new a.v,e&&this.add(...e)}add(...e){this.suggestions.atomic((()=>{for(const t of e)t.atomic((()=>{for(;!t.id||this.suggestions.has(t.id);)t.id=(0,n.O1)(11),t.commit();if(-1===t.index||this.hasIndex(t.index)){const e=this.suggestions.values.map((e=>e.index)).filter((e=>"number"==typeof e)),s=e.length?Math.max(...e):0;t.index=s+1,t.commit()}})),this.suggestions.set(t.id,t)})),this.commit()}has(e){return this.suggestions.has(e)}hasIndex(e){return!!this.suggestions.values.find((t=>t.index===e))}get(e){return this.suggestions.get(e)}getByAccepted(...e){return this.suggestions.values.filter((t=>e.includes(t.accepted)))}accept(...e){return this.updateAll(e,{accepted:!0})}reject(...e){return this.updateAll(e,{accepted:!1})}reset(...e){return this.updateAll(e,{accepted:null})}show(...e){return this.updateAll(e,{visible:!0})}hide(...e){return this.updateAll(e,{visible:!1})}updateAll(e,t){const s=e.length?e:this.suggestions.keys;this.atomic((()=>{this.suggestions.atomic((()=>{for(const e of s)if(this.has(e)){const s=this.get(e);Object.assign(s,t),s.commit()}})),this.commit()}))}}},58843:(e,t,s)=>{"use strict";s.d(t,{qY:()=>SaveSuggestionsCommand,ee:()=>ShowSuggestionsCommand,mA:()=>HideSuggestionsCommand,rf:()=>AcceptSuggestionsCommand,oA:()=>RejectSuggestionsCommand});var i=s(93037);class SaveSuggestionsCommand extends i.m{constructor(){super(...arguments),this.id="SAVE_BLUR_SUGGESTIONS"}}class ShowSuggestionsCommand extends i.m{constructor(...e){super(),this.id="SHOW_BLUR_SUGGESTIONS",this.payload={ids:e}}}class HideSuggestionsCommand extends i.m{constructor(...e){super(),this.id="HIDE_BLUR_SUGGESTIONS",this.payload={ids:e}}}class AcceptSuggestionsCommand extends i.m{constructor(...e){super(),this.id="ACCEPT_BLUR_SUGGESTIONS",this.payload={ids:e}}}class RejectSuggestionsCommand extends i.m{constructor(...e){super(),this.id="REJECT_BLUR_SUGGESTIONS",this.payload={ids:e}}}},87490:(e,t,s)=>{"use strict";s.r(t),s.d(t,{BlurSuggestionData:()=>i.a,default:()=>BlurSuggestionsModule});var i=s(19387),a=s(57227),n=s(14877),r=s(18537),o=s(60673),l=s(67495),d=s(56454),u=s(22937),c=s(73501),h=s(52549),m=s(47063);class HttpFileStore{constructor(e){this.config=e}async read(){const{url:e,deserializer:t,format:s,queue:i}=this.config;let a=await i.get(e);return"json"===s&&(a=JSON.parse(a)),t?t(a):a}}var g=s(53549),p=s(17403),b=s(77337),v=s(58843),f=s(46265),S=s(98254),B=s(81402);class BlurSuggestion extends S.T{constructor(e){super(),this.accepted=null,this.index=-1,this.classification=[],this.visible=!0,this.id=(0,B.O1)(11),e&&Object.assign(this,e)}}var C=s(39300),w=s(5477),y=s(63336);const T=new w.Z("blurSuggestionDeserializer");function E(e){const t=function(e){return function(t){const s=(0,C.LB)(null==t?void 0:t.dots),i=e.getSweepByUuid(null==t?void 0:t.sweepId);if(!(t&&s&&s.length&&i))return T.debug("Deserialized invalid Blur suggestion",t),null;const a=!0===t.accepted||!1===t.accepted?t.accepted:null;return new BlurSuggestion({id:t.sid,accepted:a,dots:s,index:t.index,floorId:i.floorId,roomId:i.roomId,sweepId:i.id,classification:t.tags||[],visible:!0,created:(0,y.p)(t.created),modified:(0,y.p)(t.modified)})}}(e);return function(e){const s={};for(const i in e){const a=t(e[i]);a&&(s[i]=a)}return s}}var x=s(9351);function I(e){const t=function(e){return function(t){const s=e.getSweep(t.sweepId),i=(0,x.o_)(t.dots);return s&&(null==i?void 0:i.length)?{sid:t.id,accepted:t.accepted,dots:i,index:t.index,sweepId:s.uuid,tags:t.classification,visible:t.visible,created:(0,y.U)(t.created),modified:(0,y.U)(t.modified)}:null}}(e);return function(e){const s={};for(const i in e){const a=t(e[i]);a&&(s[i]=a)}return s}}class BlurSuggestionStore extends f.MU{constructor(e){const{queue:t,baseUrl:s,modelId:i,sweepData:a}=e;super({queue:t,path:`${s}/api/v1/jsonstore/model/blur-suggestions/${i}`,batchUpdate:!0,deserialize:E(a),serialize:I(a)}),this.baseUrl=s,this.modelId=i}async read(){const e=await super.read();return Object.values(e||{})}async reset(){var e;const{queue:t}=this.config,s=`${this.baseUrl}/api/v1/jsonstore/model/blur-suggestions/${this.modelId}`;if(!(null===(e=this.modelId)||void 0===e?void 0:e.length))throw new Error(`Refusing to DELETE ${s}`);if(window.confirm("Are you sure you want to reset all suggestions? This cannot be undone."))return t.delete(s,this.options).then((()=>{window.location.reload()}))}}function D(e){return t=>{const s=[];if(!(null==t?void 0:t.blurs))return[];const i=Object.values(t.blurs).filter((e=>!e.blurEnabled));for(const t of i){const i=e.getSweepByUuid(t.sweepId),a=(0,C.LB)(t.dots);if(!(null==a?void 0:a.length)||!i||!Array.isArray(null==t?void 0:t.dots))continue;const n=new BlurSuggestion({accepted:null,sweepId:i.id,dots:a,classification:["face"],floorId:i.floorId||void 0,visible:!0});s.push(n)}return s}}class BlurSuggestionsModule extends a.Y{constructor(){super(...arguments),this.name="blur-suggestions"}async init(e,t){this.engine=t,this.config=e,await this.load(),await this.registerSettings()}async load(){const{baseUrl:e,modelId:t,queue:s,readonly:a}=this.config,{market:o,commandBinder:u}=this.engine,[c,p]=await Promise.all([o.waitForData(d.f),o.waitForData(g.Z)]);this.blurData=c,this.store=new BlurSuggestionStore({queue:s,baseUrl:e,modelId:t,sweepData:p}),this.data=new i.a;const b=this.store.read();if(this.log.debug("Loaded existing suggestions",b),b&&b.then((async e=>{if(this.data)if(0===e.length){const e=await this.getSuggestionsFromVision();if(!this.data)return;this.data.add(...e),this.log.debug(`Importing ${e.length} suggestions from Vision...`),u.issueCommand(new v.qY)}else this.data.add(...e||[])})),!a){const e=await this.engine.getModuleBySymbol(n.y.STORAGE);this.bindings.push(u.addBinding(v.qY,(()=>u.issueCommand(new m.VQ({dataTypes:[h.g.BLUR_SUGGESTIONS]})))),u.addBinding(v.rf,(({ids:e})=>this.accept(...e))),u.addBinding(v.oA,(({ids:e})=>this.reject(...e))),u.addBinding(v.ee,(({ids:e})=>this.show(...e))),u.addBinding(v.mA,(({ids:e})=>this.hide(...e))),e.onSave((()=>this.save()),{dataType:h.g.BLUR_SUGGESTIONS}))}o.register(this,i.a,this.data),a||(this.monitor=new l.c(this.data.suggestions,{aggregationType:r.E.Manual}))}dispose(e){super.dispose(e),e.market.unregister(this,i.a),this.data=void 0}async accept(...e){const{commandBinder:t}=this.engine,s=e.length?e.map((e=>this.data.get(e))):this.data.getByAccepted(null),i=s.map((e=>u.x.from(e)));return this.blurData.add(...i),this.data.accept(...s.map((e=>e.id))),Promise.all([t.issueCommand(new c.o8),t.issueCommand(new v.qY)]).then((()=>{}))}async reject(...e){const{commandBinder:t}=this.engine,s=e.length?e:this.data.getByAccepted(null).map((e=>e.id));return this.data.reject(...s),t.issueCommand(new v.qY)}async show(...e){this.data.show(...e)}async hide(...e){this.data.hide(...e)}async save(){const{readonly:e}=this.config;if(e||!this.monitor)return;this.monitor.commitChanges();const t=this.monitor.getDiffRecord();if(this.monitor.clearDiffRecord(),!t.length)return;const s={};for(const e of t)switch(e.action){case o.KI.added:case o.KI.updated:s[e.index]=this.data.get(e.index);break;case o.KI.removed:s[e.index]=null}return this.store.update(s).catch((e=>{this.log.error(e)}))}async getSuggestionsFromVision(){const{market:e}=this.engine,[t,s]=await Promise.all([e.waitForData(b.R),e.waitForData(g.Z)]);let i=null;const a=t.objectBlur;if(null==a?void 0:a.url){const e=new HttpFileStore({url:a.url,queue:this.config.queue||new p.RequestQueue,format:"json",deserializer:D(s)});i=await e.read()}return i||[]}async registerSettings(){const e=await this.engine.getModuleBySymbol(n.y.SETTINGS),{debug:t}=this.config;t&&e.registerMenuButton({header:"Blur Suggestions",buttonName:"Reset Suggestions",callback:()=>{this.store.reset()}})}}},77337:(e,t,s)=>{"use strict";s.d(t,{R:()=>VisionCatalogData});var i=s(35424);class VisionCatalogData extends i.V{constructor(e=[]){super(),this.catalog=e}get objectAnnotations(){return this.catalog.find((e=>"objectAnnotations"===e.name))}get semantic(){return this.catalog.find((e=>"semantic"===e.name))}get detectedObjects(){return this.catalog.find((e=>"detectedObjects"===e.name))}get objectBlur(){return this.catalog.find((e=>"objectBlur"===e.name))}}},67525:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>VisionCatalogModule});var i=s(57227),a=s(77337),n=s(33359),r=s(55594),o=s(66225),l=s(63336);class VisionCatalogStore extends o.u{async read(){return this._readAssets().then((e=>e.length?e:this._readCatalog()))}_readAssets(){const e={modelId:this.getViewId()};return this.query(n.GetVisionAssets,e).then((e=>{var t;const s=(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||{},i=[];for(const e in s){const t=s[e];t.url&&i.push({name:e,contentType:t.contentType||"unknown",format:t.format,url:t.url,validUntil:(0,l.p)(t.validUntil)})}return i}))}_readCatalog(){const e={modelId:this.getViewId()};return this.query(r.GetVisionCatalog,e).then((e=>{var t,s,i;const a=(null===(i=null===(s=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===s?void 0:s.assets)||void 0===i?void 0:i.catalog)||[],n=[];return a.forEach((e=>{if(e.url){let t=e.type||"unknown";"unknown"===t&&e.url.match(/object\//i)&&(t="objectAnnotations"),"unknown"===t&&e.url.match(/blur/i)&&(t="objectBlur"),"unknown"===t&&e.url.match(/detected/i)&&(t="detectedObjects"),n.push({name:t,format:e.format,url:e.url,contentType:e.format,validUntil:(0,l.p)(e.validUntil)})}})),n}))}}class VisionCatalogModule extends i.Y{constructor(){super(...arguments),this.name="vision-catalog"}async init(e,t){const s=new VisionCatalogStore({readonly:!0,viewId:e.baseModelId}),i=await s.read().catch((e=>(this.log.info("Failed to load Vision Catalog"),[])));this.data=new a.R(i),t.market.register(this,a.R,this.data)}dispose(e){super.dispose(e),e.market.unregister(this,a.R)}}},22937:(e,t,s)=>{"use strict";s.d(t,{x:()=>Blur});var i=s(98254),a=s(81402),n=s(91885);class Blur extends i.T{constructor(e){super(),this.dots=[],this.status=n.Q.PENDING,this.floorId=null,this.roomId=null,this.visible=!0,this.created=new Date,this.modified=new Date,this.id=(0,a.O1)(11),this.index=-1,e&&Object.assign(this,e)}get editable(){return Blur.editableStatus.includes(this.status)}add(e,t,s,i){let a=this.dots.find((e=>e.radius===t&&e.feather===s&&e.strength===i));a||(a={radius:t,feather:s,strength:i,directions:[]},this.dots.push(a)),a.directions.push(e),this.modified.setTime(Date.now()),this.commit()}static from(e){return new Blur({status:n.Q.PENDING,dots:e.dots,sweepId:e.sweepId,floorId:e.floorId||null})}get dotCount(){return this.dots.reduce(((e,t)=>e+t.directions.length),0)}get sid(){return this.id}}Blur.editableStatus=[n.Q.FAILED,n.Q.PENDING]},1615:(e,t,s)=>{"use strict";s.r(t),s.d(t,{ApplyBlursCommand:()=>i.Mh,Blur:()=>r.x,BlurData:()=>a.f,BlurStatus:()=>n.Q,DeleteBlursCommand:()=>i.TL,PublishBlursCommand:()=>i.ie,RefreshBlursCommand:()=>i.s$,SaveBlursCommand:()=>i.o8,default:()=>BlurDataModule});var i=s(73501),a=s(56454),n=s(91885),r=s(22937),o=s(57227),l=s(14877),d=s(18537),u=s(60673),c=s(67495),h=s(52549),m=s(47063),g=s(52012),p=s(48697),b=s(53549),v=s(46265),f=s(81402),S=s(5477),B=s(3157),C=s(39300),w=s(9351);const y=new S.Z("BlurStore");class BlurStore extends v.MU{constructor(e){const{baseUrl:t,modelId:s,queue:i,sweepData:a}=e;super({queue:i,path:`${t}/api/v1/jsonstore/model/blurs/${s}`,batchUpdate:!0,deserialize:(0,C.B4)(a),serialize:(0,w.fM)(a)}),this.queue=i,this.baseUrl=t,this.modelId=s,this.serialize=(0,w.o2)(a)}async apply(e,{useChunks:t,meshBlurEnabled:s,pipelineEnabled:i}){if(!i)return void y.info("Pipeline disabled, no blurs will be applied to the model");const a={enableMeshBlur:s,levels:B.TW.map((e=>({size:e.size,sigmaRadians:.5*e.sigma/e.size})))},n={};for(const s of e){const e=t?s.sweepId:0,i=this.serialize(s);i&&(n[e]||(n[e]={}),n[e][s.id]=i)}const r=Object.keys(n).length,o=[];for(const e in n){const s=n[e];t&&y.debug(`Applying ${Object.values(s).length} blurs to Sweep ${e}`);const i=this.queue.post(`${this.baseUrl}/api/v2/pano-edit/${this.modelId}/blur-panos`,{withCredentials:!0,body:{blurs:s,options:a}});o.push(i),r>o.length&&(y.debug("waiting 100ms"),await(0,f.gw)(250))}return Promise.all(o)}}class BlurDataModule extends o.Y{constructor(){super(...arguments),this.name="blur_data",this.refreshPromise=null,this.saveBlurs=async()=>{const{commandBinder:e}=this.engine;return e.issueCommand(new m.VQ({dataTypes:[h.g.BLURS]}))},this.onApplyBlursCommand=()=>this.applyBlurs()}async init(e,t){this.engine=t,this.config=e,await this.load(t)}dispose(e){super.dispose(e),e.market.unregister(this,a.f),this.data=void 0}async configureStorage(){if(this.store)return;const{baseUrl:e,modelId:t,queue:s,readonly:a}=this.config,{commandBinder:n,market:r}=this.engine,o=await r.waitForData(b.Z);this.store=new BlurStore({baseUrl:e,modelId:t,queue:s,sweepData:o}),a||(this.bindings.push(n.addBinding(i.s$,(()=>this.refresh())),n.addBinding(i.Mh,this.onApplyBlursCommand),n.addBinding(i.o8,this.saveBlurs),n.addBinding(i.TL,(async({ids:e})=>this.deleteById(...e)))),this.engine.getModuleBySymbol(l.y.STORAGE).then((e=>{this.revertHandler=e.onRevert((()=>this.revert()),{dataType:h.g.BLURS}),this.bindings.push(e.onPublish((()=>this.applyBlurs()),{phase:g.Q.BEFORE}),e.onPublish((()=>this.updatePublishableStatus()),{phase:g.Q.AFTER}),e.onSave((()=>this.save()),{dataType:h.g.BLURS}),this.revertHandler),this.updatePublishableStatus()})))}async load(e){await this.configureStorage(),this.settings=await e.getModuleBySymbol(l.y.SETTINGS),this.data=new a.f,e.market.register(this,a.f,this.data);const t=await this.store.read();return this.data.add(...Object.values(t||{})),this.monitor=new c.c(this.data.blurs,{aggregationType:d.E.Manual}),await this.updatePublishableStatus()}async updatePublishableStatus(){var e,t;if(this.storageData||(this.storageData=await this.engine.market.waitForData(p.Q)),!this.data)return;const s=this.data.hasUnappliedBlurs()&&!this.data.hasProcessingBlurs(),i=this.data.hasStatus(n.Q.PENDING);s?this.storageData.setPublishableType(h.g.BLURS):this.storageData.clearPublishableType(h.g.BLURS),i?(this.storageData.setRevertableType(h.g.BLURS),null===(e=this.revertHandler)||void 0===e||e.renew()):(this.storageData.clearRevertableType(h.g.BLURS),null===(t=this.revertHandler)||void 0===t||t.cancel()),s||i?this.storageData.setDirtyType(h.g.BLURS):this.storageData.clearDirtyType(h.g.BLURS)}async refresh(){if(this.refreshPromise)return;if(!this.data.hasAppliedBlurs())return;const e=this.store.read().then((e=>{this.updateBlursFrom(...Object.values(e||{}))})).finally((()=>{this.refreshPromise=null}));return this.refreshPromise=e,e}async save(){if(!this.monitor||this.config.readonly)return void this.log.warn("Blur changes will NOT be saved");await this.refresh(),this.monitor.commitChanges();const e=this.monitor.getDiffRecord().filter((({index:e,action:t})=>t===u.KI.removed||this.data.has(e)&&this.data.get(e).editable));if(this.monitor.clearDiffRecord(),!e.length)return;const t={};for(const s of e)switch(s.action){case u.KI.added:case u.KI.updated:t[s.index]=this.data.get(s.index);break;case u.KI.removed:t[s.index]=null}return this.store.update(t).finally((()=>{this.updatePublishableStatus()}))}async applyBlurs(){var e,t,s;if(this.data.hasProcessingBlurs())return;await this.save();const i=this.data.getByStatus(n.Q.PENDING,n.Q.FAILED);if(!i.length)return;i.length>B.Dr&&(this.log.info(`Publishing Blurs: Truncating request to the maximum of ${B.Dr} Blurs. Total Pending: ${i.length}`),i.length=B.Dr),this.data.setStatus(n.Q.PROCESSING,...i.map((e=>e.id))),this.log.info(`Applying ${i.length} blurs...`);const a=null===(e=this.settings)||void 0===e?void 0:e.tryGetProperty(B.n5,!1),r=null===(t=this.settings)||void 0===t?void 0:t.tryGetProperty(B.i7,!1),o=null===(s=this.settings)||void 0===s?void 0:s.tryGetProperty(B.pv,!1);return this.store.apply(i,{useChunks:o,meshBlurEnabled:r,pipelineEnabled:a}).finally((()=>{this.updatePublishableStatus()}))}async revert(){const e=this.data.getByStatus(n.Q.PENDING).map((e=>e.id));if(e.length)return this.data.delete(...e),this.save()}async deleteById(...e){if(this.data.delete(...e))return this.save()}updateBlursFrom(...e){this.data.atomic((()=>{e.forEach((e=>{if(this.data.has(e.id)){const t=this.data.get(e.id);e.status!==t.status&&(t.status=e.status,t.modified.setTime(e.modified.getTime()),t.commit())}}))})),this.updatePublishableStatus()}}},39300:(e,t,s)=>{"use strict";s.d(t,{B4:()=>h,LB:()=>m});var i=s(63336),a=s(5477),n=s(63387),r=s(22937),o=s(91885),l=s(3157),d=s(37936),u=s(94772);const c=new a.Z("blurDeserializer");function h(e){const t=function(e){return function(t){var s;const a=m(null==t?void 0:t.dots),n=e.getSweepByUuid(null===(s=null==t?void 0:t.sweepId)||void 0===s?void 0:s.replace(/-/g,""));if(!(t&&a&&a.length&&n))return c.debug("Deserialized invalid Blur",t),null;const d=new r.x({id:t.sid,index:"number"==typeof t.index?t.index:-1,status:t.status,sweepId:n.id,created:(0,i.p)(t.created)});return n.placementType!==u.hU.UNPLACED&&(d.floorId=n.floorId,d.roomId=n.roomId),a.forEach((e=>{e.directions.forEach((t=>{d.add(t,e.radius,e.feather,e.strength)}))})),d.modified=(0,i.p)(t.modified),d.status===o.Q.PROCESSING&&Date.now()-d.modified.getTime()>l.gJ&&(d.status=o.Q.FAILED),d}}(e);return function(e){const s={};for(const i of Object.values(e)){const e=t(i);e&&(s[e.id]=e)}return s}}function m(e){if(!e||!Array.isArray(e))return null;const t=[];for(const s of e)if(g(s)){const e=s.unitVectors.map((e=>n.ep.fromVisionVector({x:"string"==typeof e.x?parseFloat(e.x):e.x,y:"string"==typeof e.y?parseFloat(e.y):e.y,z:"string"==typeof e.z?parseFloat(e.z):e.z})));t.push({directions:e,radius:(0,d.d)(s.radius),feather:"string"==typeof s.feather?parseFloat(s.feather):s.feather,strength:"string"==typeof s.strength?parseFloat(s.strength):s.strength})}return t}function g(e){return["unitVectors","radius","strength","feather"].every((t=>t in e))}},9351:(e,t,s)=>{"use strict";s.d(t,{o2:()=>o,fM:()=>l,o_:()=>d});var i=s(63336),a=s(63387),n=s(65),r=s(37936);function o(e){return function(t){if(!t)return null;const s=e.getSweep(t.sweepId),a=d(t.dots);if(!s||!(null==a?void 0:a.length))return null;return{sid:t.id,index:t.index,sweepId:s.uuid,status:t.status,dots:a,visible:t.visible,created:(0,i.U)(t.created),modified:(0,i.U)(t.modified)}}}function l(e){const t=o(e);return function(e){const s={};for(const i of Object.values(e)){const e=t(i);e&&(s[i.id]=e)}return s}}function d(e){if(!e)return null;return function(e,t=5){return e.map((e=>({unitVectors:e.unitVectors.map((e=>({x:(0,a.Zd)(e.x,t),y:(0,a.Zd)(e.y,t),z:(0,a.Zd)(e.z,t)}))),radius:(0,a.Zd)(e.radius,t),feather:(0,a.Zd)(e.feather,t),strength:(0,a.Zd)(e.strength,3)})))}(e.map((e=>({unitVectors:e.directions.map((e=>(0,n.m)(a.ep.toVisionVector(e)))),radius:(0,r.t)(e.radius),feather:e.feather,strength:e.strength}))))}},37936:(e,t,s)=>{"use strict";s.d(t,{t:()=>a,d:()=>n});var i=s(3157);function a(e){return Math.atan(e/i.U_)}function n(e){return i.U_*Math.tan(e)}},80122:(e,t,s)=>{"use strict";s.d(t,{M:()=>SetPanoOverlayCommand});var i=s(93037);class SetPanoOverlayCommand extends i.m{constructor(e,t,s){super(),this.id="SET_PANO_OVERLAY",this.payload={sweepId:e,texture:t,quaternion:s}}}},46265:(e,t,s)=>{"use strict";s.d(t,{MU:()=>JsonStoreStore});var i,a=s(81402),n=s(78804);!function(e){e.GET="GET",e.POST="POST",e.PATCH="PATCH",e.PUT="PUT",e.DELETE="DELETE",e.OPTIONS="OPTIONS"}(i||(i={}));class ReadOnlyStore extends class Auth{constructor(){this._options={responseType:"json"}}get options(){const e=this._options;return e.headers=(0,n.m)(this.url,this._options.headers||{}),e}}{constructor(e){super(),this.config=e,this.url=e.path}async read(){const{deserialize:e}=this.config;let t=null;return this.config.cachedData&&this.config.cachedData.data?t=this.config.cachedData.data:(t=await this.config.queue.get(this.config.path,this.options),this.config.cachedData&&(this.config.cachedData.data=t)),e(t)}clearCache(){this.config.cachedData&&(this.config.cachedData.data=null)}}class JsonStoreStore extends ReadOnlyStore{constructor(e){super(e),this.config=e,this.acceptsPartial=!1,this.config.batchUpdate="batchUpdate"in this.config&&this.config.batchUpdate}async create(e){throw Error("Not implemented")}updateBatch(e,t){const{serialize:s}=this.config,a=[],n=[...new Set([...Object.keys(e),...Object.keys(t)])];for(const s of n){e[s]||t[s]||a.push(this.config.queue.delete(`${this.config.path}/${s}`,this.options))}const r=s(e,t),o=Object.assign(Object.assign({},this.options),{body:r});return a.push(this.config.queue.request(this.config.httpMethod||i.POST,this.config.path,o)),Promise.all(a)}updateInternal(e,t){const{serialize:s}=this.config,n=[],r=Object.assign({},this.options),o=Object.keys(e),l=Object.keys(t),d=(0,a.XN)(o.concat(l));for(const a in d){const o=d[a],l=e[o]||t[o];if(l){const e={};e[o]=l;const a={},d=t[o];d&&(a[o]=d);const u=s(e,a);r.body=u,n.push(this.config.queue.request(this.config.httpMethod||i.POST,this.config.path,r))}else n.push(this.config.queue.delete(`${this.config.path}/${o}`,this.options))}return Promise.all(n)}async update(e,t){this.clearCache(),await(this.config.batchUpdate?this.updateBatch(e,t||{}):this.updateInternal(e,t||{}))}async delete(e){throw Error("Not implemented")}}},20959:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform vec3 opacity;uniform vec3 radius;uniform vec3 feather;uniform vec3 color;varying vec4 vCenter;varying vec4 vPosition;void main(){float fragRadius=length(vPosition.xyz-vCenter.xyz);vec3 featherStart=radius-feather;vec3 circleAlphaWithFeather=1.-max(fragRadius-featherStart,0.)/(feather*2.);gl_FragColor=vec4(color.rgb*opacity*circleAlphaWithFeather,1.);}"},682:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;attribute mat4 instanceMatrix;varying vec4 vCenter;varying vec4 vPosition;void main(){vPosition=instanceMatrix*vec4(position,1.);vCenter=instanceMatrix*vec4(0.,0.,0.,1.);gl_Position=projectionMatrix*modelViewMatrix*vPosition;}"},10385:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;varying vec4 maskPosition;varying vec4 panoPosition;uniform samplerCube maskTexture;uniform samplerCube panoBlurredMap0;uniform samplerCube panoBlurredMap1;uniform samplerCube panoBlurredMap2;uniform samplerCube panoBlurredMap3;const vec4 SELECTED_OUTLINE_COLOR=vec4(1.,1.,1.,1.);const vec4 HOVER_COLOR=vec4(1.,1.,1.,1.);vec4 combineBlurs(vec4 mask,vec4 blurredColor0,vec4 blurredColor1,vec4 blurredColor2,vec4 blurredColor3){float maskAlpha=mask.r;float selectedAlpha=mask.g;float hoveredAlpha=mask.b;float targetSigma=maskAlpha*(4.*4.-1.);float blurRatio=log2(1.+targetSigma);float panoAlpha=max(1.-abs(blurRatio-0.)/1.,0.);float blurAlpha0=max(1.-abs(blurRatio-1.)/1.,0.);float blurAlpha1=max(1.-abs(blurRatio-2.)/1.,0.);float blurAlpha2=max(1.-abs(blurRatio-3.)/1.,0.);float blurAlpha3=max(1.-abs(blurRatio-4.)/1.,0.);float alpha=blurAlpha0+blurAlpha1+blurAlpha2+blurAlpha3;vec4 color=(panoAlpha*blurredColor0+blurAlpha0*blurredColor0+blurAlpha1*blurredColor1+blurAlpha2*blurredColor2+blurAlpha3*blurredColor3);color.a=alpha;float selectedMaskAlpha=smoothstep(0.65,0.75,selectedAlpha)*(1.-smoothstep(0.85,0.95,selectedAlpha));color=mix(color,SELECTED_OUTLINE_COLOR,selectedMaskAlpha);color=mix(color,HOVER_COLOR,hoveredAlpha*0.3);return color;}void main(){vec4 mask=textureCube(maskTexture,maskPosition.xyz);\n#ifdef DEBUG_BLUR_LEVELS\nmask=vec4(fract(gl_FragCoord.x/2048.),0.,0.,1.);\n#endif\nvec4 blurredColor0=textureCube(panoBlurredMap0,panoPosition.xyz);vec4 blurredColor1=textureCube(panoBlurredMap1,panoPosition.xyz);vec4 blurredColor2=textureCube(panoBlurredMap2,panoPosition.xyz);vec4 blurredColor3=textureCube(panoBlurredMap3,panoPosition.xyz);\n# ifdef DEBUG_BLUR_LEVELS\nif(gl_FragCoord.y>2000.){blurredColor0=vec4(1.,0.,0.,1.);blurredColor1=vec4(0.,1.,0.,1.);blurredColor2=vec4(0.,0.,1.,1.);blurredColor3=vec4(0.,1.,1.,1.);}\n#elif defined(DEBUG_BLUR_COLORS)\nblurredColor0=vec4(1.,0.,0.,1.);blurredColor1=vec4(0.,1.,0.,1.);blurredColor2=vec4(0.,0.,1.,1.);blurredColor3=vec4(0.,1.,1.,1.);\n#endif\ngl_FragColor=combineBlurs(mask,blurredColor0,blurredColor1,blurredColor2,blurredColor3);}"},65697:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec4 maskPosition;varying vec4 panoPosition;uniform mat4 maskMatrix;uniform mat4 panoMatrix1;uniform mat4 panoMatrix2;void main(){vec4 worldPosition=modelMatrix*vec4(position,1.);maskPosition=maskMatrix*worldPosition;panoPosition=panoMatrix2*panoMatrix1*worldPosition;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},33359:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetVisionAssets"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"objectBlur"},name:{kind:"Name",value:"asset"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"StringValue",value:"blurs/suggestions",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contentType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BlurSuggestionAsset"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"version"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:383}};t.loc.source={body:'# Fetches public output files from the Vision Catalog,\n# only available after platform 21.21.1 release\nquery GetVisionAssets($modelId: ID!) {\n  model(id: $modelId) {\n    objectBlur: asset(id: "blurs/suggestions") {\n      id\n      status\n      contentType\n      filename\n      format\n      url\n      validUntil\n      ... on BlurSuggestionAsset {\n          version\n      }\n    }\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};function s(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){s(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){s(e,t)})),e.definitions&&e.definitions.forEach((function(e){s(e,t)}))}var i={};function a(e,t){for(var s=0;s<e.definitions.length;s++){var i=e.definitions[s];if(i.name&&i.name.value==t)return i}}t.definitions.forEach((function(e){if(e.name){var t=new Set;s(e,t),i[e.name.value]=t}})),e.exports=t,e.exports.GetVisionAssets=function(e,t){var s={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(s.loc=e.loc);var n=i[t]||new Set,r=new Set,o=new Set;for(n.forEach((function(e){o.add(e)}));o.size>0;){var l=o;o=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(i[e]||new Set).forEach((function(e){o.add(e)})))}))}return r.forEach((function(t){var i=a(e,t);i&&s.definitions.push(i)})),s}(t,"GetVisionAssets")},55594:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetVisionCatalog"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"catalog"},arguments:[{kind:"Argument",name:{kind:"Name",value:"formats"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"json",block:!1}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contentType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:271}};t.loc.source={body:'# Fetches Vision Catalog assets, restricted to staff users\nquery GetVisionCatalog($modelId: ID!) {\n  model(id: $modelId) {\n    assets {\n      catalog(formats: ["json"]) {\n        format\n        type\n        contentType\n        description\n        url\n      }\n    }\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};function s(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){s(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){s(e,t)})),e.definitions&&e.definitions.forEach((function(e){s(e,t)}))}var i={};function a(e,t){for(var s=0;s<e.definitions.length;s++){var i=e.definitions[s];if(i.name&&i.name.value==t)return i}}t.definitions.forEach((function(e){if(e.name){var t=new Set;s(e,t),i[e.name.value]=t}})),e.exports=t,e.exports.GetVisionCatalog=function(e,t){var s={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(s.loc=e.loc);var n=i[t]||new Set,r=new Set,o=new Set;for(n.forEach((function(e){o.add(e)}));o.size>0;){var l=o;o=new Set,l.forEach((function(e){r.has(e)||(r.add(e),(i[e]||new Set).forEach((function(e){o.add(e)})))}))}return r.forEach((function(t){var i=a(e,t);i&&s.definitions.push(i)})),s}(t,"GetVisionCatalog")}}]);